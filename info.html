<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智评生活 - 个人主页</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <!-- 引入样式 -->
  <link rel="stylesheet" href="./css/element.css">

  <link href="./css/index.css" rel="stylesheet">
  <link href="./css/main.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background-color: #f8f9fa;
    }

    #app {
      min-height: 100vh;
      padding-bottom: 60px;
      position: relative;
      background: #f8f9fa;
    }

    /* 头部样式 */
    .header {
      display: flex;
      align-items: center;
      padding: 15px;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-back-btn {
      font-size: 18px;
      color: #333;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .header-back-btn:hover {
      background-color: #f5f5f5;
    }

    .header-title {
      flex: 1;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    /* 个人主页样式优化 */
    .basic {
      display: flex;
      align-items: center;
      padding: 25px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .basic-icon img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }

    .basic-icon img:hover {
      transform: scale(1.05);
    }

    .basic-info {
      flex: 1;
      margin-left: 20px;
    }

    .basic-info .name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .basic-info span {
      font-size: 14px;
      opacity: 0.9;
      display: block;
      margin-bottom: 8px;
    }

    .edit-btn {
      margin-top: 8px;
      padding: 6px 16px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 18px;
      font-size: 13px;
      display: inline-block;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.4);
      transition: all 0.3s;
      backdrop-filter: blur(5px);
    }

    .edit-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .logout-btn {
      position: absolute;
      top: 25px;
      right: 20px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: color 0.3s;
      padding: 6px 12px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
    }

    .logout-btn:hover {
      color: white;
      background: rgba(255, 255, 255, 0.2);
    }

    /* 统计信息 */
    .stats {
      display: flex;
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }

    .stat-item {
      flex: 1;
      text-align: center;
      border-right: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.3s;
      padding: 8px 0;
    }

    .stat-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
    }

    .stat-item:last-child {
      border-right: none;
    }

    .stat-number {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 13px;
      color: #999;
    }

    /* 个人简介 */
    .introduce {
      padding: 18px 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #666;
      cursor: pointer;
      transition: background-color 0.3s;
      line-height: 1.5;
      position: relative;
    }

    .introduce:hover {
      background-color: #f9f9f9;
      padding-left: 25px;
    }

    .introduce i {
      margin-left: 5px;
      color: #409EFF;
      transition: transform 0.3s;
    }

    .introduce:hover i {
      transform: translateX(3px);
    }

    /* 内容区域 */
    .content {
      background: #f8f9fa;
      min-height: calc(100vh - 300px);
    }

    /* 标签页样式优化 */
    .el-tabs {
      height: 100%;
    }

    .el-tabs__header {
      background: white;
      margin: 0;
      padding: 0 20px;
    }

    .el-tabs__nav-wrap::after {
      background-color: #f0f0f0;
    }

    .el-tabs__item {
      font-weight: 500;
      color: #666;
      padding: 0 15px;
      height: 50px;
      line-height: 50px;
    }

    .el-tabs__item.is-active {
      color: #409EFF;
      font-weight: 600;
    }

    .el-tabs__active-bar {
      background-color: #409EFF;
      height: 3px;
    }

    .el-tabs__content {
      padding: 0;
      overflow: visible;
    }

    .el-tab-pane {
      padding: 0;
    }

    /* 笔记列表优化 */
    .blog-item {
      display: flex;
      padding: 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
      margin-bottom: 0;
    }

    .blog-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .blog-img {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      margin-right: 18px;
      flex-shrink: 0;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .blog-img:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .blog-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .blog-img:hover img {
      transform: scale(1.05);
    }

    .blog-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .blog-title {
      font-size: 16px;
      color: #333;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      cursor: pointer;
      transition: color 0.3s;
      font-weight: 500;
      margin-bottom: 10px;
    }

    .blog-title:hover {
      color: #409EFF;
    }

    .blog-meta {
      display: flex;
      align-items: center;
      color: #999;
      font-size: 13px;
    }

    .blog-liked,
    .blog-comments,
    .blog-share {
      display: flex;
      align-items: center;
      margin-right: 18px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .blog-liked:hover,
    .blog-comments:hover,
    .blog-share:hover {
      background-color: #f5f5f5;
      transform: translateY(-1px);
    }

    .blog-liked.active {
      color: #ff6633;
    }

    .blog-liked.active img {
      filter: brightness(0) saturate(100%) invert(47%) sepia(90%) saturate(2000%) hue-rotate(350deg) brightness(100%) contrast(100%);
    }

    .blog-liked img,
    .blog-comments img {
      width: 16px;
      height: 16px;
      margin-right: 5px;
    }

    /* 关注/粉丝列表优化 */
    .user-list {
      background: white;
    }

    .user-item {
      display: flex;
      align-items: center;
      padding: 18px 20px;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
    }

    .user-item:hover {
      background-color: #f9f9f9;
      transform: translateX(5px);
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
      flex-shrink: 0;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-info {
      flex: 1;
      cursor: pointer;
    }

    .user-name {
      font-size: 16px;
      color: #333;
      margin-bottom: 5px;
      font-weight: 500;
      transition: color 0.3s;
    }

    .user-name:hover {
      color: #409EFF;
    }

    .user-desc {
      font-size: 13px;
      color: #999;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .follow-btn {
      padding: 7px 18px;
      border: 1px solid #409EFF;
      border-radius: 18px;
      color: #409EFF;
      font-size: 13px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .follow-btn:hover {
      background: #409EFF;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(64, 158, 255, 0.3);
    }

    .follow-btn.following {
      background: #f0f0f0;
      color: #999;
      border-color: #f0f0f0;
    }

    .follow-btn.following:hover {
      background: #e0e0e0;
      border-color: #e0e0e0;
      color: #777;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* 评价列表 */
    .review-item {
      padding: 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
    }

    .review-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .review-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 12px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .review-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .review-user {
      flex: 1;
    }

    .review-user-name {
      font-size: 15px;
      color: #333;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .review-rating {
      color: #ff9900;
      font-size: 13px;
    }

    .review-content {
      font-size: 14px;
      color: #333;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .review-images {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

    .review-image {
      width: 80px;
      height: 80px;
      border-radius: 6px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .review-image:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .review-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .review-footer {
      display: flex;
      align-items: center;
      color: #999;
      font-size: 13px;
    }

    .review-time {
      flex: 1;
    }

    .review-actions {
      display: flex;
      align-items: center;
    }

    .review-action {
      display: flex;
      align-items: center;
      margin-left: 15px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .review-action:hover {
      background-color: #f5f5f5;
      transform: translateY(-1px);
    }

    /* 空状态 */
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #999;
      background: white;
    }

    .empty-icon {
      font-size: 60px;
      margin-bottom: 20px;
      opacity: 0.4;
    }

    .empty-text {
      font-size: 15px;
    }

    /* 底部导航 */
    .foot-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: white;
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }

    .foot-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      height: 100%;
      cursor: pointer;
      transition: all 0.3s;
      color: #999;
    }

    .foot-btn.active {
      color: #409EFF;
    }

    .foot-btn:hover {
      background-color: #f9f9f9;
    }

    .foot-icon {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .foot-text {
      font-size: 12px;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
      .basic {
        padding: 20px 15px;
      }

      .blog-item {
        padding: 15px;
      }

      .user-item {
        padding: 15px;
      }

      .review-item {
        padding: 15px;
      }

      .blog-img {
        width: 80px;
        height: 80px;
        margin-right: 15px;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="header-back-btn" @click="goBack"><i class="el-icon-arrow-left"></i></div>
    <div class="header-title">个人主页</div>
  </div>

  <div class="basic">
    <div class="basic-icon">
      <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
    </div>
    <div class="basic-info">
      <div class="name">{{user.nickName || '未设置昵称'}}</div>
      <span>{{info.city || '未知城市'}}</span>
      <div class="edit-btn" @click="toEdit">
        编辑资料
      </div>
    </div>
    <div class="logout-btn" @click="logout">
      退出登录
    </div>
  </div>

  <!-- 统计信息 -->
  <div class="stats">
    <div class="stat-item" @click="activeName = 'note'">
      <div class="stat-number">{{stats.noteCount || 0}}</div>
      <div class="stat-label">笔记</div>
    </div>
    <div class="stat-item" @click="activeName = 'fans'">
      <div class="stat-number">{{stats.fansCount || 0}}</div>
      <div class="stat-label">粉丝</div>
    </div>
    <div class="stat-item" @click="activeName = 'follow'">
      <div class="stat-number">{{stats.followCount || 0}}</div>
      <div class="stat-label">关注</div>
    </div>
    <div class="stat-item" @click="activeName = 'review'">
      <div class="stat-number">{{stats.likeCount || 0}}</div>
      <div class="stat-label">获赞</div>
    </div>
  </div>

  <div class="introduce" @click="toEdit">
    <span v-if="info.introduce">{{info.introduce}}</span>
    <span v-else>添加个人简介，让大家更好的认识你 <i class="el-icon-edit"></i></span>
  </div>

  <div class="content">
    <el-tabs v-model="activeName" @tab-click="handleClick">
      <!-- 笔记标签页 -->
      <el-tab-pane label="笔记" name="note">
        <div v-if="blogs.length > 0">
          <div v-for="b in blogs" :key="b.id" class="blog-item">
            <div class="blog-img" @click="toBlogDetail(b)">
              <img :src="getFirstImage(b.images)" alt="">
            </div>
            <div class="blog-info">
              <div class="blog-title" @click="toBlogDetail(b)">{{b.title}}</div>
              <div class="blog-meta">
                <div class="blog-liked"
                     :class="{'active': b.isLike}"
                     @click.stop="toggleLike(b)">
                  <img src="/imgs/thumbup.png" alt="">
                  {{b.liked || 0}}
                </div>
                <div class="blog-comments" @click.stop="toBlogDetail(b)">
                  <i class="el-icon-chat-dot-round"></i>
                  {{b.comments || 0}}
                </div>
                <div class="blog-share" @click.stop="shareBlog(b)">
                  <i class="el-icon-share"></i>
                  分享
                </div>
              </div>
            </div>
          </div>
        </div>
        <div v-else class="empty-state">
          <div class="empty-icon"><i class="el-icon-document"></i></div>
          <div class="empty-text">还没有发布任何笔记</div>
        </div>
      </el-tab-pane>

      <!-- 评价标签页 -->
      <el-tab-pane :label="'评价(' + (reviews.length) + ')'" name="review">
        <div v-if="reviews.length > 0">
          <div v-for="review in reviews" :key="review.id" class="review-item">
            <div class="review-header">
              <div class="review-avatar">
                <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
              </div>
              <div class="review-user">
                <div class="review-user-name">{{user.nickName}}</div>
                <div class="review-rating">
                  <i class="el-icon-star-on" v-for="n in 5" :key="n"
                     :style="{color: n <= (review.rating || 5) ? '#ff9900' : '#ddd'}"></i>
                </div>
              </div>
            </div>
            <div class="review-content">{{review.content || '这个用户还没有写评价内容'}}</div>
            <div class="review-images" v-if="review.images">
              <div class="review-image" v-for="(img, index) in review.images.split(',')" :key="index" @click="previewImage(img)">
                <img :src="img" alt="">
              </div>
            </div>
            <div class="review-footer">
              <div class="review-time">{{formatTime(review.createTime)}}</div>
              <div class="review-actions">
                <div class="review-action" @click="toggleReviewLike(review)">
                  <i class="el-icon-thumb"></i> {{review.liked || 0}}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div v-else class="empty-state">
          <div class="empty-icon"><i class="el-icon-chat-dot-round"></i></div>
          <div class="empty-text">还没有发布任何评价</div>
        </div>
      </el-tab-pane>

      <!-- 粉丝标签页 -->
      <el-tab-pane :label="'粉丝(' + (fansList.length) + ')'" name="fans">
        <div class="user-list">
          <div v-if="fansList.length > 0">
            <div v-for="user in fansList" :key="user.id" class="user-item">
              <div class="user-avatar" @click="toUserDetail(user)">
                <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
              </div>
              <div class="user-info" @click="toUserDetail(user)">
                <div class="user-name">{{user.nickName || '匿名用户'}}</div>
                <div class="user-desc">{{user.introduce || '这个人很懒，什么都没写'}}</div>
              </div>
              <button class="follow-btn" :class="{'following': user.isFollowed}"
                      @click.stop="toggleFollow(user)">
                {{user.isFollowed ? '已关注' : '关注'}}
              </button>
            </div>
          </div>
          <div v-else class="empty-state">
            <div class="empty-icon"><i class="el-icon-user"></i></div>
            <div class="empty-text">还没有粉丝</div>
          </div>
        </div>
      </el-tab-pane>

      <!-- 关注标签页 -->
      <el-tab-pane :label="'关注(' + (followList.length) + ')'" name="follow">
        <div class="user-list">
          <div v-if="followList.length > 0">
            <div v-for="user in followList" :key="user.id" class="user-item">
              <div class="user-avatar" @click="toUserDetail(user)">
                <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
              </div>
              <div class="user-info" @click="toUserDetail(user)">
                <div class="user-name">{{user.nickName || '匿名用户'}}</div>
                <div class="user-desc">{{user.introduce || '这个人很懒，什么都没写'}}</div>
              </div>
              <button class="follow-btn following" @click.stop="unfollow(user)">
                已关注
              </button>
            </div>
          </div>
          <div v-else class="empty-state">
            <div class="empty-icon"><i class="el-icon-star-off"></i></div>
            <div class="empty-text">还没有关注任何人</div>
          </div>
        </div>
      </el-tab-pane>
    </el-tabs>
  </div>

  <foot-bar :active-btn="4"></foot-bar>
</div>

<script src="./js/vue.js"></script>
<script src="./js/axios.min.js"></script>
<!-- 引入组件库 -->
<script src="./js/element.js"></script>
<script src="./js/common.js"></script>
<script src="./js/footer.js"></script>
<script>
  new Vue({
    el: '#app',
    data() {
      return {
        user: {},
        activeName: "note",
        activeBtn: 4,
        info: {},
        blogs: [],
        reviews: [],
        fansList: [],
        followList: [],
        stats: {
          noteCount: 0,
          fansCount: 0,
          followCount: 0,
          likeCount: 0
        },
        loading: false
      }
    },
    created() {
      this.queryUser();
    },
    methods: {
      // 获取第一张图片
      getFirstImage(images) {
        if (!images) return '/imgs/default-blog.jpg';
        const imageArray = images.split(',');
        return imageArray[0] || '/imgs/default-blog.jpg';
      },

      // 查询用户信息
      queryUser() {
        axios.get("/app/user/me")
                .then(({data}) => {
                  this.user = data;
                  this.queryUserInfo();
                  this.queryUserStats();
                  this.queryBlogs();
                  this.queryReviews();
                })
                .catch(err => {
                  console.error('获取用户信息失败:', err);
                  // location.href = "login.html"
                })
      },

      // 查询用户详情
      queryUserInfo() {
        axios.get("/app/user/info/getUserInfo/" + this.user.id)
                .then(({data}) => {
                  if (data) {
                    this.info = data;
                    sessionStorage.setItem("userInfo", JSON.stringify(data))
                  }
                })
                .catch(err => {
                  console.error('获取用户详情失败:', err);
                })
      },

      // 查询用户统计信息
      queryUserStats() {
        // 模拟统计信息，实际应该调用后端接口
        this.stats = {
          noteCount: this.blogs.length,
          fansCount: this.fansList.length,
          followCount: this.followList.length,
          likeCount: this.blogs.reduce((sum, blog) => sum + (blog.liked || 0), 0)
        };

        // 实际应该调用接口
        // axios.get("/app/user/info/stats/" + this.user.id)
        //   .then(({data}) => {
        //     if (data) {
        //       this.stats = data;
        //     }
        //   })
        //   .catch(err => {
        //     console.error('获取统计信息失败:', err);
        //   })
      },

      // 查询笔记
      queryBlogs() {
        axios.get("/app/blog/of/me")
                .then(({data}) => {
                  this.blogs = data || [];
                  // 为每个笔记初始化点赞状态
                  this.blogs.forEach(blog => {
                    this.checkLikeStatus(blog);
                  });
                  this.queryUserStats();
                })
                .catch(err => {
                  console.error('获取笔记失败:', err);
                  this.blogs = [];
                  this.queryUserStats();
                })
      },

      // 检查点赞状态
      checkLikeStatus(blog) {
        // 模拟点赞状态检查
        blog.isLike = Math.random() > 0.5;

        // 实际应该调用接口
        // axios.get("/app/blog/like/status/" + blog.id)
        //   .then(({data}) => {
        //     blog.isLike = data.isLike || false;
        //   })
        //   .catch(() => {
        //     blog.isLike = false;
        //   });
      },

      // 查询评价
      queryReviews() {
        // 模拟评价数据
        this.reviews = [
          {
            id: 1,
            content: '这家餐厅的环境很不错，服务也很周到，下次还会再来！',
            rating: 5,
            liked: 12,
            createTime: new Date(Date.now() - 2 * 60 * 60 * 1000)
          },
          {
            id: 2,
            content: '产品性价比很高，使用体验很好，推荐给大家！',
            rating: 4,
            liked: 8,
            createTime: new Date(Date.now() - 24 * 60 * 60 * 1000)
          }
        ];

        // 实际应该调用接口
        // axios.get("/app/review/of/me")
        //   .then(({data}) => {
        //     this.reviews = data || [];
        //   })
        //   .catch(err => {
        //     console.error('获取评价失败:', err);
        //     this.reviews = [];
        //   })
      },

      // 查询粉丝列表
      queryFans() {
        // 模拟粉丝数据
        this.fansList = [
          {
            id: 101,
            nickName: '小明同学',
            introduce: '热爱生活，喜欢分享',
            icon: '/imgs/icons/default-icon.png',
            isFollowed: true
          },
          {
            id: 102,
            nickName: '美食达人',
            introduce: '专业美食评测',
            icon: '/imgs/icons/default-icon.png',
            isFollowed: false
          }
        ];
        this.stats.fansCount = this.fansList.length;

        // 实际应该调用接口
        // axios.get("/app/user/follow/fans")
        //   .then(({data}) => {
        //     this.fansList = data || [];
        //     this.stats.fansCount = this.fansList.length;
        //   })
        //   .catch(err => {
        //     console.error('获取粉丝列表失败:', err);
        //     this.fansList = [];
        //   })
      },

      // 查询关注列表
      queryFollows() {
        // 模拟关注数据
        this.followList = [
          {
            id: 201,
            nickName: '旅行博主',
            introduce: '环游世界，分享美景',
            icon: '/imgs/icons/default-icon.png'
          },
          {
            id: 202,
            nickName: '科技爱好者',
            introduce: '关注最新科技动态',
            icon: '/imgs/icons/default-icon.png'
          }
        ];
        this.stats.followCount = this.followList.length;

        // 实际应该调用接口
        // axios.get("/app/user/follow/follows")
        //   .then(({data}) => {
        //     this.followList = data || [];
        //     this.stats.followCount = this.followList.length;
        //   })
        //   .catch(err => {
        //     console.error('获取关注列表失败:', err);
        //     this.followList = [];
        //   })
      },

      // 标签切换
      handleClick(tab) {
        if (tab.name === 'fans') {
          this.queryFans();
        } else if (tab.name === 'follow') {
          this.queryFollows();
        }
      },

      // 点赞/取消点赞
      toggleLike(blog) {
        if (blog.isLike) {
          this.unlikeBlog(blog);
        } else {
          this.likeBlog(blog);
        }
      },

      // 点赞
      likeBlog(blog) {
        blog.isLike = true;
        blog.liked = (blog.liked || 0) + 1;
        this.$message.success('点赞成功');

        // 实际应该调用接口
        // axios.post("/app/blog/like/" + blog.id)
        //   .then(({data}) => {
        //     blog.isLike = true;
        //     blog.liked = (blog.liked || 0) + 1;
        //     this.$message.success('点赞成功');
        //   })
        //   .catch(err => {
        //     this.$message.error('点赞失败');
        //   })
      },

      // 取消点赞
      unlikeBlog(blog) {
        blog.isLike = false;
        blog.liked = Math.max(0, (blog.liked || 1) - 1);
        this.$message.success('取消点赞');

        // 实际应该调用接口
        // axios.delete("/app/blog/like/" + blog.id)
        //   .then(({data}) => {
        //     blog.isLike = false;
        //     blog.liked = Math.max(0, (blog.liked || 1) - 1);
        //     this.$message.success('取消点赞');
        //   })
        //   .catch(err => {
        //     this.$message.error('取消点赞失败');
        //   })
      },

      // 评价点赞
      toggleReviewLike(review) {
        review.liked = (review.liked || 0) + 1;
        this.$message.success('点赞成功');
      },

      // 关注/取消关注
      toggleFollow(user) {
        if (user.isFollowed) {
          this.unfollow(user);
        } else {
          this.follow(user);
        }
      },

      follow(user) {
        user.isFollowed = true;
        this.$message.success('关注成功');
        this.stats.followCount++;

        // 实际应该调用接口
        // axios.post("/app/user/follow/" + user.id)
        //   .then(() => {
        //     user.isFollowed = true;
        //     this.$message.success('关注成功');
        //     this.stats.followCount++;
        //   })
        //   .catch(err => {
        //     this.$message.error('关注失败');
        //   })
      },

      unfollow(user) {
        user.isFollowed = false;
        this.$message.success('取消关注成功');
        this.stats.followCount--;
        // 如果是关注列表，从列表中移除
        if (this.activeName === 'follow') {
          this.followList = this.followList.filter(u => u.id !== user.id);
        }

        // 实际应该调用接口
        // axios.delete("/app/user/follow/" + user.id)
        //   .then(() => {
        //     user.isFollowed = false;
        //     this.$message.success('取消关注成功');
        //     this.stats.followCount--;
        //     if (this.activeName === 'follow') {
        //       this.followList = this.followList.filter(u => u.id !== user.id);
        //     }
        //   })
        //   .catch(err => {
        //     this.$message.error('取消关注失败');
        //   })
      },

      // 分享笔记
      shareBlog(blog) {
        this.$confirm('分享到其他平台?', '分享', {
          confirmButtonText: '复制链接',
          cancelButtonText: '取消',
          type: 'info'
        }).then(() => {
          const url = window.location.origin + '/blog-detail.html?id=' + blog.id;
          this.copyToClipboard(url);
          this.$message.success('链接已复制到剪贴板');
        }).catch(() => {
          // 用户取消
        });
      },

      // 复制到剪贴板
      copyToClipboard(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      },

      // 图片预览
      previewImage(imgUrl) {
        // 这里可以实现图片预览功能
        this.$message.info('图片预览功能');
      },

      // 跳转到用户详情
      toUserDetail(user) {
        if (user.id === this.user.id) {
          // 如果是自己，刷新当前页面
          this.queryUser();
        } else {
          location.href = "other-info.html?id=" + user.id;
        }
      },

      // 跳转到笔记详情
      toBlogDetail(blog) {
        location.href = "blog-detail.html?id=" + blog.id;
      },

      // 格式化时间
      formatTime(time) {
        if (!time) return '';
        const date = new Date(time);
        const now = new Date();
        const diff = now - date;

        if (diff < 60000) return '刚刚';
        if (diff < 3600000) return Math.floor(diff / 60000) + '分钟前';
        if (diff < 86400000) return Math.floor(diff / 3600000) + '小时前';
        if (diff < 604800000) return Math.floor(diff / 86400000) + '天前';

        return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
      },

      goBack() {
        history.back();
      },

      toEdit() {
        location.href = 'info-edit.html'
      },

      logout() {
        this.$confirm('确定要退出登录吗？', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          axios.post("/app/auth/appLogout")
                  .then(() => {
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
                  .catch(() => {
                    // 即使请求失败也清理本地数据
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
        })
      },

      changeTab(index) {
        this.activeBtn = index;
        if (index !== 4) {
          console.log('切换到标签页:', index);
        }
      }
    }
  });
</script>
</body>
</html>