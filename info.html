<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ªäººä¸»é¡µ</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <link rel="stylesheet" href="./css/element.css">
  <link href="./css/index.css" rel="stylesheet">
  <link href="./css/main.css" rel="stylesheet">
  <style>
    /* ====================================== æ–°å¢ï¼šåŠ è½½é®ç½©å±‚æ ·å¼ ====================================== */
    #app {
      min-height: 100vh;
      padding-bottom: 60px; /* ä¸ºåº•éƒ¨å¯¼èˆªæ é¢„ç•™ç©ºé—´ */
      position: relative;
      background: #f8f9fa;
    }

    .loading-mask {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .loading-mask.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #409EFF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    .loading-text {
      font-size: 16px;
      color: #666;
      text-align: center;
    }

    .loading-subtext {
      font-size: 14px;
      color: #999;
      margin-top: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background-color: #f8f9fa;
      touch-action: pan-y;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 15px;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-back-btn {
      font-size: 18px;
      color: #333;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .header-back-btn:hover {
      background-color: #f5f5f5;
    }

    .header-title {
      flex: 1;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .basic {
      display: flex;
      align-items: center;
      padding: 25px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .basic-icon img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }

    .basic-icon img:hover {
      transform: scale(1.05);
    }

    .basic-info {
      flex: 1;
      margin-left: 20px;
    }

    .basic-info .name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .basic-info span {
      font-size: 14px;
      opacity: 0.9;
      display: block;
      margin-bottom: 8px;
    }

    .edit-btn {
      margin-top: 8px;
      padding: 6px 16px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 18px;
      font-size: 13px;
      display: inline-block;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.4);
      transition: all 0.3s;
      backdrop-filter: blur(5px);
    }

    .edit-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .logout-btn {
      position: absolute;
      top: 25px;
      right: 20px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: color 0.3s;
      padding: 6px 12px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
    }

    .logout-btn:hover {
      color: white;
      background: rgba(255, 255, 255, 0.2);
    }

    .stats {
      display: flex;
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }

    .stat-item {
      flex: 1;
      text-align: center;
      border-right: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.3s;
      padding: 8px 0;
      position: relative;
      overflow: hidden;
    }

    .stat-item:last-child {
      border-right: none;
    }

    .stat-item::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(64, 158, 255, 0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.6s ease;
    }

    .stat-item:active::after {
      width: 100px;
      height: 100px;
    }

    .stat-number {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
      transition: color 0.3s;
    }

    .stat-label {
      font-size: 13px;
      color: #999;
      transition: color 0.3s;
    }

    .stat-item:hover .stat-number,
    .stat-item:hover .stat-label {
      color: #409EFF;
    }

    .quick-actions {
      display: flex;
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
      margin-top: 0;
    }

    .action-item {
      flex: 1;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      padding: 12px 0;
      position: relative;
      overflow: hidden;
    }

    .action-item::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(64, 158, 255, 0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.6s ease;
    }

    .action-item:active::after {
      width: 100px;
      height: 100px;
    }

    .action-icon {
      font-size: 24px;
      color: #409EFF;
      margin-bottom: 8px;
      transition: all 0.3s;
    }

    .action-label {
      font-size: 14px;
      color: #333;
      font-weight: 500;
      transition: color 0.3s;
    }

    .action-item:hover .action-icon {
      transform: translateY(-3px);
    }

    .action-item:hover .action-label {
      color: #409EFF;
    }

    .introduce {
      padding: 18px 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #666;
      cursor: pointer;
      transition: background-color 0.3s;
      line-height: 1.5;
      position: relative;
    }

    .introduce:hover {
      background-color: #f9f9f9;
      padding-left: 25px;
    }

    .introduce i {
      margin-left: 5px;
      color: #409EFF;
      transition: transform 0.3s;
    }

    .introduce:hover i {
      transform: translateX(3px);
    }

    .content {
      background: #f8f9fa;
      position: relative;
      overflow: hidden;
      /* ä¿®æ”¹ï¼šè°ƒæ•´å†…å®¹åŒºåŸŸé«˜åº¦ */
      min-height: calc(100vh - 400px);
    }

    .custom-tabs-header {
      background: white;
      padding: 16px 16px 8px;
      position: relative;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .custom-tabs-nav {
      display: flex;
      justify-content: space-between;
      background: #f8f9f9;
      border-radius: 10px;
      padding: 4px;
      position: relative;
    }

    .custom-tab-item {
      flex: 1;
      text-align: center;
      padding: 14px 8px;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 2;
      margin: 0 2px;
      border: none;
      background: transparent;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      pointer-events: auto;
      min-width: 0;
      overflow: hidden;
    }

    .custom-tab-item::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(64, 158, 255, 0.15);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.5s ease;
      z-index: -1;
    }

    .custom-tab-item:active::before {
      width: 100%;
      height: 100%;
      border-radius: 8px;
    }

    .custom-tab-item:hover {
      color: #409EFF;
      background: rgba(64, 158, 255, 0.08);
      transform: translateY(-1px);
    }

    .custom-tab-item.active {
      color: #409EFF;
      background: white;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
      transform: translateY(0);
    }

    .custom-tab-item.active::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: #409EFF;
      border-radius: 2px;
    }

    .tab-text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .count-badge {
      font-size: 11px;
      background: #ff4757;
      color: white;
      border-radius: 8px;
      padding: 1px 4px;
      margin-left: 4px;
      min-width: 16px;
      text-align: center;
      line-height: 1.2;
      font-weight: 500;
    }

    /* ä¿®æ”¹ï¼šé‡æ–°è®¾è®¡æ ‡ç­¾é¡µå®¹å™¨ */
    .tabs-container {
      position: relative;
      height: auto;
      min-height: 400px;
      touch-action: pan-x;
    }

    .tabs-content {
      display: flex;
      height: auto;
      min-height: 400px;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    /* ä¿®æ”¹ï¼šé‡æ–°è®¾è®¡æ ‡ç­¾é¡µå†…å®¹åŒºåŸŸ */
    .tab-pane {
      flex: 0 0 100%;
      height: auto;
      min-height: 400px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 80px; /* å¢åŠ åº•éƒ¨å†…è¾¹è· */
      margin-bottom: 0;
    }

    .custom-tabs-content {
      display: block;
      height: auto;
      min-height: 400px;
      margin-top: 0;
    }

    /* åšå®¢é¡¹æ ·å¼ - ä¿®æ”¹åçš„ç»“æ„ */
    .blog-item {
      background: white;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
      margin-bottom: 0;
    }

    .blog-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .blog-user-info {
      display: flex;
      align-items: center;
      padding: 15px 20px 12px;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .blog-user-info:hover {
      background-color: #f8f9fa;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      overflow: hidden;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-details {
      flex: 1;
    }

    .user-nickname {
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 2px;
    }

    .blog-time {
      font-size: 12px;
      color: #999;
    }

    .blog-content {
      display: flex;
      padding: 0 20px 20px;
    }

    .blog-img {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      margin-right: 18px;
      flex-shrink: 0;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .blog-img:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .blog-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .blog-img:hover img {
      transform: scale(1.05);
    }

    .blog-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .blog-title {
      font-size: 16px;
      color: #333;
      line-height: 1.5;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition: color 0.3s;
      font-weight: 500;
      margin-bottom: 10px;
      max-width: 100%;
    }

    .blog-title:hover {
      color: #409EFF;
    }

    .blog-meta {
      display: flex;
      align-items: center;
      color: #999;
      font-size: 13px;
    }

    .blog-liked,
    .blog-comments,
    .blog-share {
      display: flex;
      align-items: center;
      margin-right: 18px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .blog-liked:hover,
    .blog-comments:hover,
    .blog-share:hover {
      background-color: #f5f5f5;
      transform: translateY(-1px);
    }

    .blog-liked.active {
      color: #ff6633;
    }

    .blog-liked.active img {
      filter: brightness(0) saturate(100%) invert(47%) sepia(90%) saturate(2000%) hue-rotate(350deg) brightness(100%) contrast(100%);
    }

    .blog-liked img,
    .blog-comments img {
      width: 16px;
      height: 16px;
      margin-right: 5px;
    }

    /* æ–°å¢ï¼šåº—é“ºåˆ—è¡¨æ ·å¼ */
    .shop-item {
      display: flex;
      padding: 12px 15px;
      background-color: #fff;
      border-bottom: 1px solid #f5f5f5;
      transition: background-color 0.2s;
    }

    .shop-item:hover {
      background-color: #fafafa;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .shop-img {
      width: 90px;
      height: 90px;
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .shop-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .shop-info {
      flex: 1;
      padding-left: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .shop-title {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      line-height: 1.4;
      margin-bottom: 5px;
      cursor: pointer;
    }

    .shop-title:hover {
      color: #409EFF;
    }

    .shop-rate {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .shop-rate .el-rate {
      margin-right: 8px;
    }

    .shop-rate span {
      font-size: 12px;
      color: #999;
    }

    .shop-area {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .shop-avg {
      font-size: 12px;
      color: #ff6633;
      margin-bottom: 5px;
    }

    .shop-address {
      display: flex;
      align-items: center;
      font-size: 12px;
      color: #999;
    }

    .shop-address i {
      margin-right: 4px;
      font-size: 14px;
    }

    /* æ”¶è—æ“ä½œæŒ‰é’® */
    .collection-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .collection-btn {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-btn {
      background-color: #07c160;
      color: white;
    }

    .uncollect-btn {
      background-color: #ff6633;
      color: white;
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #999;
      background: white;
    }

    .empty-icon {
      font-size: 60px;
      margin-bottom: 20px;
      opacity: 0.4;
    }

    .empty-text {
      font-size: 15px;
    }

    .loading-indicator {
      text-align: center;
      padding: 15px;
      color: #909399;
      font-size: 14px;
      background: white;
    }

    .loading-indicator .el-icon-loading {
      margin-right: 5px;
    }

    .no-more-data {
      text-align: center;
      padding: 15px;
      color: #C0C4CC;
      font-size: 14px;
      background: white;
    }

    .load-error {
      text-align: center;
      padding: 15px;
      color: #F56C6C;
      font-size: 14px;
      background: white;
    }

    .load-error .retry-btn {
      color: #409EFF;
      cursor: pointer;
      margin-left: 5px;
    }

    /* ä¿®æ”¹ï¼šåº•éƒ¨å¯¼èˆªæ æ ·å¼è°ƒæ•´ */
    .foot-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: white;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #eee;
      z-index: 100;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }

    .foot-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      height: 100%;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      text-decoration: none;
    }

    .foot-btn.active {
      color: #409EFF;
    }

    .foot-btn:hover {
      background-color: #f9f9f9;
    }

    .foot-icon {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .foot-text {
      font-size: 12px;
    }

    .el-message-box__wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .el-message-box {
      position: static !important;
      margin: 0 !important;
      top: auto !important;
      left: auto !important;
      transform: none !important;
      width: 90% !important;
      max-width: 320px !important;
    }

    .el-message-box__btns {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 15px 20px 20px;
    }

    .el-message-box__btn {
      min-width: 90px;
      padding: 8px 15px;
    }

    .image-preview-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .preview-container {
      background: white;
      border-radius: 8px;
      max-width: 90%;
      max-height: 90%;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-title {
      font-weight: 600;
    }

    .close-btn {
      cursor: pointer;
      font-size: 18px;
    }

    .preview-content {
      flex: 1;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-image {
      max-width: 100%;
      max-height: 400px;
      object-fit: contain;
    }

    .preview-footer {
      padding: 15px;
      border-top: 1px solid #eee;
    }

    .preview-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .nav-btn {
      background: #409EFF;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
    }

    .nav-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .preview-counter {
      font-size: 14px;
      color: #666;
    }

    /* æŠ–éŸ³é£æ ¼ç‚¹èµåŠ¨ç”» */
    .like-animation-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

    .like-particle {
      position: absolute;
      font-size: 24px;
      color: #ff2e63;
      opacity: 0;
      pointer-events: none;
      z-index: 10000;
      user-select: none;
      -webkit-user-select: none;
      text-shadow: 0 0 10px rgba(255, 46, 99, 0.5);
    }

    .like-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 30px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      z-index: 10001;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: likePopup 1.5s ease-out forwards;
    }

    .like-popup i {
      color: #ff2e63;
      font-size: 24px;
      animation: heartBeat 0.6s ease-in-out 3;
    }

    .unlike-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 30px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      z-index: 10001;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: unlikePopup 1.5s ease-out forwards;
    }

    .unlike-popup i {
      color: #999;
      font-size: 24px;
    }

    @keyframes likePopup {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      40% {
        transform: translate(-50%, -50%) scale(1);
      }
      80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
    }

    @keyframes unlikePopup {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      40% {
        transform: translate(-50%, -50%) scale(1);
      }
      80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
    }

    @keyframes heartBeat {
      0% {
        transform: scale(1);
      }
      25% {
        transform: scale(1.3);
      }
      50% {
        transform: scale(1);
      }
      75% {
        transform: scale(1.3);
      }
      100% {
        transform: scale(1);
      }
    }

    /* æŠ–éŸ³é£æ ¼è·èµæç¤ºæ ·å¼ */
    .douyin-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 500;
      z-index: 10001;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: douyinToast 2s ease-in-out forwards;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    .douyin-toast i {
      color: #ff2e63;
      font-size: 18px;
      animation: heartPulse 1s ease-in-out infinite;
    }

    @keyframes douyinToast {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      15% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      30% {
        transform: translate(-50%, -50%) scale(1);
      }
      70% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }
    }

    @keyframes heartPulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }

    /* æ–°å¢ï¼šåº•éƒ¨å®‰å…¨åŒºåŸŸé€‚é… */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      #app {
        padding-bottom: calc(60px + env(safe-area-inset-bottom));
      }

      .foot-bar {
        height: calc(60px + env(safe-area-inset-bottom));
        padding-bottom: env(safe-area-inset-bottom);
      }

      .tab-pane {
        padding-bottom: calc(80px + env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
<div id="app">
  <!-- æ–°å¢ï¼šåŠ è½½é®ç½©å±‚ -->
  <div class="loading-mask" :class="{ hidden: !isLoading }">
    <div class="loading-spinner"></div>
    <div class="loading-text">æ­£åœ¨åŠ è½½ä¸ªäººä¸»é¡µ</div>
    <div class="loading-subtext">è¯·ç¨å€™...</div>
  </div>

  <div class="header">
    <div class="header-back-btn" @click="goBack"><i class="el-icon-arrow-left"></i></div>
    <div class="header-title">ä¸ªäººä¸»é¡µ</div>
  </div>

  <div class="basic">
    <div class="basic-icon">
      <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
    </div>
    <div class="basic-info">
      <div class="name">{{user.nickName || 'æœªè®¾ç½®æ˜µç§°'}}</div>
      <span>{{info.city || 'æœªçŸ¥åŸå¸‚'}}</span>
      <div class="edit-btn" @click="toEdit">
        ç¼–è¾‘èµ„æ–™
      </div>
    </div>
    <div class="logout-btn" @click="logout">
      é€€å‡ºç™»å½•
    </div>
  </div>

  <div class="stats">
    <div class="stat-item" @click="showLikeCount">
      <div class="stat-number">{{stats.likeCount || 0}}</div>
      <div class="stat-label">è·èµ</div>
    </div>
    <div class="stat-item" @click="switchTab('follow')">
      <div class="stat-number">{{stats.followCount || 0}}</div>
      <div class="stat-label">å…³æ³¨</div>
    </div>
    <div class="stat-item" @click="switchTab('fans')">
      <div class="stat-number">{{stats.fansCount || 0}}</div>
      <div class="stat-label">ç²‰ä¸</div>
    </div>
  </div>

  <div class="introduce" @click="toEdit">
    <span v-if="info.introduce">{{info.introduce}}</span>
    <span v-else>æ·»åŠ ä¸ªäººç®€ä»‹ï¼Œè®©å¤§å®¶æ›´å¥½çš„è®¤è¯†ä½  <i class="el-icon-edit"></i></span>
  </div>

  <div class="quick-actions">
    <div class="action-item" @click="goToReviews">
      <div class="action-icon">
        <i class="el-icon-chat-dot-round"></i>
      </div>
      <div class="action-label">æˆ‘çš„è¯„ä»·</div>
    </div>
    <div class="action-item" @click="goToOrders">
      <div class="action-icon">
        <i class="el-icon-shopping-bag-1"></i>
      </div>
      <div class="action-label">æˆ‘çš„è®¢å•</div>
    </div>
  </div>

  <div class="content">
    <div class="custom-tabs-header">
      <div class="custom-tabs-nav">
        <div class="custom-tab-item"
             :class="{ active: activeName === 'note' }"
             @click="switchTabWithFeedback('note')">
          <div class="tab-text">
            ç¬”è®°
            <span v-if="blogs.length > 0" class="count-badge">{{formatCount(blogs.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'collection' }"
             @click="switchTabWithFeedback('collection')">
          <div class="tab-text">
            åº—é“ºæ”¶è—
            <span v-if="collections.length > 0" class="count-badge">{{formatCount(collections.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'feed' }"
             @click="switchTabWithFeedback('feed')">
          <div class="tab-text">
            åŠ¨æ€
            <span v-if="feeds.length > 0" class="count-badge">{{formatCount(feeds.length)}}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="custom-tabs-content">
      <div class="tabs-container">
        <div class="tabs-content" :style="{ transform: `translateX(-${currentIndex * 100}%)` }">

          <!-- ç¬”è®°æ ‡ç­¾é¡µ -->
          <div class="tab-pane" @scroll="onScroll($event, 'blog')">
            <div v-if="blogs.length > 0">
              <div v-for="b in blogs" :key="b.id" class="blog-item">
                <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
                <div class="blog-user-info" @click="toUserDetail(b)">
                  <div class="user-avatar">
                    <img :src="b.icon || '/imgs/icons/default-icon.png'" alt="ç”¨æˆ·å¤´åƒ">
                  </div>
                  <div class="user-details">
                    <div class="user-nickname">{{ b.nickName || user.nickName || 'åŒ¿åç”¨æˆ·' }}</div>
                    <div class="blog-time">{{ formatTime(b.createTime) }}</div>
                  </div>
                </div>

                <!-- åšå®¢å†…å®¹ -->
                <div class="blog-content">
                  <div class="blog-img" @click="toBlogDetail(b)">
                    <img :src="getFirstImage(b.images)" alt="">
                  </div>
                  <div class="blog-info">
                    <div class="blog-title" @click="toBlogDetail(b)">{{ truncateTitle(b.title, 20) }}</div>
                    <div class="blog-meta">
                      <div class="blog-liked"
                           :class="{'active': b.isLike}"
                           @click.stop="toggleLikeWithAnimation(b)">
                        <img src="/imgs/thumbup.png" alt="">
                        {{b.liked || 0}}
                      </div>
                      <div class="blog-comments" @click.stop="toBlogDetail(b)">
                        <i class="el-icon-chat-dot-round"></i>
                        {{b.comments || 0}}
                      </div>
                      <div class="blog-share" @click.stop="shareBlog(b)">
                        <i class="el-icon-share"></i>
                        åˆ†äº«
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="loading-indicator" v-if="blogLoading">
                <i class="el-icon-loading"></i> æ­£åœ¨åŠ è½½æ›´å¤šç¬”è®°...
              </div>

              <div class="no-more-data" v-if="blogNoMore && !blogLoading">
                <i class="el-icon-finished"></i> æ²¡æœ‰æ›´å¤šç¬”è®°äº†
              </div>

              <div class="load-error" v-if="blogLoadError && !blogLoading">
                <i class="el-icon-warning"></i> åŠ è½½å¤±è´¥
                <span class="retry-btn" @click="retryLoadBlogs">ç‚¹å‡»é‡è¯•</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-document"></i></div>
              <div class="empty-text">è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•ç¬”è®°</div>
            </div>
          </div>

          <!-- åº—é“ºæ”¶è—æ ‡ç­¾é¡µ -->
          <div class="tab-pane" @scroll="onScroll($event, 'collection')">
            <div v-if="collections.length > 0">
              <div v-for="shop in collections" :key="shop.id" class="shop-item">
                <div class="shop-img" @click="toShopDetail(shop)">
                  <img :src="getFirstImage(shop.images)" alt="" @error="handleImgError($event)">
                </div>
                <div class="shop-info">
                  <div class="shop-title" @click="toShopDetail(shop)">{{ shop.name }}</div>
                  <div class="shop-rate">
                    <el-rate
                            disabled
                            v-model="shop.score/10"
                            text-color="#F63"
                            show-score
                    ></el-rate>
                    <span>{{ shop.comments }}æ¡</span>
                  </div>
                  <div class="shop-area">
                    <span>{{ shop.area }}</span>
                    <span v-if="shop.distance">
                      {{ shop.distance < 1000 ? shop.distance.toFixed(1) + 'm' : (shop.distance/1000).toFixed(1) + 'km' }}
                    </span>
                  </div>
                  <div class="shop-avg">ï¿¥{{ shop.avgPrice }}/äºº</div>
                  <div class="shop-address">
                    <i class="el-icon-map-location"></i>
                    <span>{{ shop.address }}</span>
                  </div>
                  <div class="collection-actions">
                    <button class="collection-btn view-btn" @click.stop="toShopDetail(shop)">
                      æŸ¥çœ‹è¯¦æƒ…
                    </button>
                    <button class="collection-btn uncollect-btn" @click.stop="uncollectShop(shop.id)">
                      å–æ¶ˆæ”¶è—
                    </button>
                  </div>
                </div>
              </div>

              <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
              <div class="loading-indicator" v-if="collectionLoading">
                <i class="el-icon-loading"></i> æ­£åœ¨åŠ è½½æ›´å¤šåº—é“ºæ”¶è—...
              </div>

              <div class="no-more-data" v-if="collectionNoMore && !collectionLoading">
                <i class="el-icon-finished"></i> æ²¡æœ‰æ›´å¤šåº—é“ºæ”¶è—äº†
              </div>

              <div class="load-error" v-if="collectionLoadError && !collectionLoading">
                <i class="el-icon-warning"></i> åŠ è½½å¤±è´¥
                <span class="retry-btn" @click="retryLoadCollections">ç‚¹å‡»é‡è¯•</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-star-off"></i></div>
              <div class="empty-text">è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•åº—é“º</div>
            </div>
          </div>

          <!-- åŠ¨æ€æ ‡ç­¾é¡µ -->
          <div class="tab-pane" @scroll="onScroll($event, 'feed')">
            <div v-if="feeds.length > 0">
              <div v-for="b in feeds" :key="b.id" class="blog-item">
                <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
                <div class="blog-user-info" @click="toUserDetail(b)">
                  <div class="user-avatar">
                    <img :src="b.icon || '/imgs/icons/default-icon.png'" alt="ç”¨æˆ·å¤´åƒ">
                  </div>
                  <div class="user-details">
                    <div class="user-nickname">{{ b.name || 'åŒ¿åç”¨æˆ·' }}</div>
                    <div class="blog-time">{{ formatTime(b.createTime) }}</div>
                  </div>
                </div>

                <!-- åšå®¢å†…å®¹ -->
                <div class="blog-content">
                  <div class="blog-img" @click="toBlogDetail(b)">
                    <img :src="getFirstImage(b.images)" alt="">
                  </div>
                  <div class="blog-info">
                    <div class="blog-title" @click="toBlogDetail(b)">{{ truncateTitle(b.title, 20) }}</div>
                    <div class="blog-meta">
                      <div class="blog-liked"
                           :class="{'active': b.isLike}"
                           @click.stop="toggleLikeWithAnimation(b)">
                        <img src="/imgs/thumbup.png" alt="">
                        {{b.liked || 0}}
                      </div>
                      <div class="blog-comments" @click.stop="toBlogDetail(b)">
                        <i class="el-icon-chat-dot-round"></i>
                        {{b.comments || 0}}
                      </div>
                      <div class="blog-share" @click.stop="shareBlog(b)">
                        <i class="el-icon-share"></i>
                        åˆ†äº«
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="loading-indicator" v-if="feedLoading">
                <i class="el-icon-loading"></i> æ­£åœ¨åŠ è½½æ›´å¤šåŠ¨æ€...
              </div>

              <div class="no-more-data" v-if="feedNoMore && !feedLoading">
                <i class="el-icon-finished"></i> æ²¡æœ‰æ›´å¤šåŠ¨æ€äº†
              </div>

              <div class="load-error" v-if="feedLoadError && !feedLoading">
                <i class="el-icon-warning"></i> åŠ è½½å¤±è´¥
                <span class="retry-btn" @click="retryLoadFeeds">ç‚¹å‡»é‡è¯•</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-document"></i></div>
              <div class="empty-text">è¿˜æ²¡æœ‰å…³æ³¨äººçš„åŠ¨æ€</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <foot-bar :active-btn="4" class="foot-bar"></foot-bar>

  <!-- ç‚¹èµåŠ¨ç”»å®¹å™¨ -->
  <div class="like-animation-container" id="likeAnimationContainer"></div>
</div>

<script src="./js/vue.js"></script>
<script src="./js/axios.min.js"></script>
<script src="./js/element.js"></script>
<script src="./js/common.js"></script>
<script src="./js/footer.js"></script>
<script>
  new Vue({
    el: '#app',
    data() {
      return {
        user: {},
        activeName: "note",
        activeBtn: 4,
        info: {},
        blogs: [],
        feeds: [],
        collections: [], // æ–°å¢ï¼šåº—é“ºæ”¶è—æ•°æ®
        params: {
          minTime: 0,
          offset: 0,
        },
        stats: {
          likeCount: 0,
          fansCount: 0,
          followCount: 0,
          collectCount:0,
        },
        // åˆ†é¡µæ•°æ®
        blogCurrent: 1,
        blogSize: 10,
        blogLoading: false,
        blogNoMore: false,
        blogLoadError: false,

        feedCurrent: 1,
        feedSize: 10,
        feedLoading: false,
        feedNoMore: false,
        feedLoadError: false,

        // åº—é“ºæ”¶è—åˆ†é¡µ
        collectionCurrent: 1,
        collectionSize: 10,
        collectionLoading: false,
        collectionNoMore: false,
        collectionLoadError: false,

        // æ»‘åŠ¨ç›¸å…³æ•°æ®
        currentIndex: 0,
        tabOrder: ['note', 'collection', 'feed'],

        // æ»šåŠ¨èŠ‚æµ
        scrollThrottle: null,

        // å›¾ç‰‡é¢„è§ˆç›¸å…³
        showImagePreview: false,
        previewImages: [],
        currentPreviewImage: '',
        currentPreviewIndex: 0,

        // æ–°å¢ï¼šåŠ è½½çŠ¶æ€æ§åˆ¶
        isLoading: true,
        // æ•°æ®åŠ è½½å®Œæˆè®¡æ•°å™¨
        dataLoadedCount: 0,
        // éœ€è¦åŠ è½½çš„æ•°æ®æ€»æ•°
        totalDataToLoad: 5 // ç”¨æˆ·ä¿¡æ¯ã€ç”¨æˆ·è¯¦æƒ…ã€ç»Ÿè®¡æ•°æ®ã€ç¬”è®°ã€åº—é“ºæ”¶è—ã€åŠ¨æ€
      }
    },
    created() {
      this.queryUser();
      this.currentIndex = this.tabOrder.indexOf(this.activeName);
    },
    watch: {
      activeName(newVal) {
        this.currentIndex = this.tabOrder.indexOf(newVal);
      }
    },
    methods: {
      // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ
      onDataLoaded() {
        this.dataLoadedCount++;
        console.log(`æ•°æ®åŠ è½½è¿›åº¦: ${this.dataLoadedCount}/${this.totalDataToLoad}`);

        // å½“æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆæ—¶éšè—é®ç½©å±‚
        if (this.dataLoadedCount >= this.totalDataToLoad) {
          setTimeout(() => {
            this.isLoading = false;
            console.log('æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆï¼Œéšè—é®ç½©å±‚');
          }, 500); // å»¶è¿Ÿ500mséšè—ï¼Œè®©ç”¨æˆ·çœ‹åˆ°åŠ è½½å®Œæˆ
        }
      },

      // å¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥
      handleImgError(event) {
        event.target.src = '/imgs/icons/default-icon.png';
      },

      // æŸ¥è¯¢åº—é“ºæ”¶è—
      queryCollections() {
        if (!this.user.id) return;
        this.collectionLoading = true;
        this.collectionLoadError = false;
        this.collectionCurrent = 1;

        axios.get("/app/follow/followShop/followShops", {
          params: {
            userId: this.user.id,
            current: this.collectionCurrent
          }
        })
                .then(({data}) => {
                  if (!data) {
                    return
                  }
                  data.forEach(s => s.images = fileURL+s.images.split(',')[0]);
                  this.collections = data || [];
                  this.collectionNoMore = false;
                  this.collectionLoading = false;
                  this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ
                })
                .catch(err => {
                  console.error("è·å–åº—é“ºæ”¶è—å¤±è´¥:", err);
                  this.collectionLoading = false;
                  this.collectionLoadError = true;
                  this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
                });
      },

      // åŠ è½½æ›´å¤šåº—é“ºæ”¶è—
      loadMoreCollections() {
        if (this.collectionLoading || this.collectionLoadError || this.collectionNoMore) return;

        this.collectionLoading = true;
        this.collectionLoadError = false;
        const nextPage = this.collectionCurrent + 1;

        axios.get("/app/follow/followShop/followShops", {
          params: {
            userId: this.user.id,
            type: 'shop',
            current: nextPage
          }
        })
                .then((response) => {
                  response.data.forEach(s => s.images = fileURL+s.images.split(',')[0]);
                  const newCollections = response.data || [];
                  if (newCollections.length > 0) {
                    this.collections = [...this.collections, ...newCollections];
                    this.collectionCurrent = nextPage;
                    if (newCollections.length < 5) {
                      this.collectionNoMore = true;
                    }
                  } else {
                    this.collectionNoMore = true;
                  }
                  this.collectionLoading = false;
                })
                .catch(err => {
                  console.error("åŠ è½½æ›´å¤šåº—é“ºæ”¶è—å¤±è´¥:", err);
                  this.collectionLoading = false;
                  this.collectionLoadError = true;
                });
      },

      // å–æ¶ˆæ”¶è—åº—é“º
      uncollectShop(shopId) {
        axios.put('/app/follow/followShop/'+ shopId + "/" + false)
                .then(() => {
                  this.$message.success('å–æ¶ˆæ”¶è—æˆåŠŸ');
                  // ä»åˆ—è¡¨ä¸­ç§»é™¤
                  this.collections = this.collections.filter(item => item.id !== shopId);
                })
                .catch(err => {
                  console.error("å–æ¶ˆæ”¶è—å¤±è´¥:", err);
                  this.$message.error('å–æ¶ˆæ”¶è—å¤±è´¥');
                });
      },

      // è·³è½¬åˆ°åº—é“ºè¯¦æƒ…
      toShopDetail(shop) {
        if (shop.id) {
          location.href = `/shop-detail.html?id=${shop.id}`;
        }
      },

      retryLoadCollections() {
        this.collectionLoadError = false;
        this.collectionNoMore = false;
        this.collectionCurrent = 1;
        this.queryCollections();
      },

      // æ˜¾ç¤ºæŠ–éŸ³é£æ ¼è·èµæç¤º
      showLikeCount() {
        // åˆ›å»ºæŠ–éŸ³é£æ ¼æç¤º
        const toast = document.createElement('div');
        toast.className = 'douyin-toast';

        // éšæœºé€‰æ‹©ä¸åŒçš„æç¤ºè¯­
        const messages = [
          `ğŸ‰ ${this.user.nickName || 'ä½ '}è¶…æœ‰é­…åŠ›ï¼è·å¾—äº†${this.stats.likeCount || 0}ä¸ªèµ`,
          `ğŸ’– å¤ªæ£’äº†ï¼${this.user.nickName || 'ä½ '}æ”¶è·äº†${this.stats.likeCount || 0}é¢—å°å¿ƒå¿ƒ`,
          `âœ¨ ${this.user.nickName || 'ä½ '}çš„æ‰åè¢«${this.stats.likeCount || 0}æ¬¡è®¤å¯`,
          `ğŸŒŸ å“‡ï¼${this.user.nickName || 'ä½ '}å·²ç»æ”¶åˆ°${this.stats.likeCount || 0}ä¸ªèµå•¦`,
          `â¤ï¸ ${this.stats.likeCount || 0}ä¸ªèµè¯æ˜${this.user.nickName || 'ä½ '}è¶…å—æ¬¢è¿`
        ];

        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        toast.innerHTML = `<i class="el-icon-star-on"></i> ${randomMessage}`;

        document.body.appendChild(toast);

        // 2ç§’åè‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 2000);
      },

      // å¸¦åŠ¨ç”»çš„ç‚¹èµåˆ‡æ¢
      toggleLikeWithAnimation(blog) {
        if (blog.isLike) {
          this.unlikeBlogWithAnimation(blog);
        } else {
          this.likeBlogWithAnimation(blog);
        }
      },

      // å¸¦åŠ¨ç”»çš„ç‚¹èµ
      likeBlogWithAnimation(blog) {
        blog.isLike = true;
        blog.liked = (blog.liked || 0) + 1;
        this.addLike(blog);

        // åˆ›å»ºç‚¹èµåŠ¨ç”»
        this.createLikeAnimation('ç‚¹èµæˆåŠŸï¼');
      },

      // å¸¦åŠ¨ç”»çš„å–æ¶ˆç‚¹èµ
      unlikeBlogWithAnimation(blog) {
        blog.isLike = false;
        blog.liked = Math.max(0, (blog.liked || 0) - 1);
        this.addLike(blog);

        // åˆ›å»ºå–æ¶ˆç‚¹èµåŠ¨ç”»
        this.createUnlikeAnimation('å–æ¶ˆç‚¹èµ');
      },

      // åˆ›å»ºç‚¹èµåŠ¨ç”»
      createLikeAnimation(message) {
        const container = document.getElementById('likeAnimationContainer');

        // åˆ›å»ºä¸­å¿ƒå¼¹çª—
        const popup = document.createElement('div');
        popup.className = 'like-popup';
        popup.innerHTML = `<i class="el-icon-star-on"></i> ${message}`;
        container.appendChild(popup);

        // åˆ›å»ºç²’å­æ•ˆæœ
        for (let i = 0; i < 12; i++) {
          setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'like-particle';
            particle.innerHTML = 'â¤';
            particle.style.left = '50%';
            particle.style.top = '50%';
            particle.style.opacity = '1';

            // éšæœºè§’åº¦å’Œè·ç¦»
            const angle = (i * 30) * Math.PI / 180;
            const distance = 100 + Math.random() * 50;
            const targetX = Math.cos(angle) * distance;
            const targetY = Math.sin(angle) * distance;

            // åŠ¨ç”»
            particle.animate([
              {
                transform: 'translate(-50%, -50%) scale(0)',
                opacity: 0
              },
              {
                transform: 'translate(-50%, -50%) scale(1)',
                opacity: 1
              },
              {
                transform: `translate(calc(-50% + ${targetX}px), calc(-50% + ${targetY}px)) scale(0.5)`,
                opacity: 0
              }
            ], {
              duration: 1000,
              easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)'
            });

            container.appendChild(particle);

            // æ¸…ç†
            setTimeout(() => {
              if (particle.parentNode) {
                particle.parentNode.removeChild(particle);
              }
            }, 1000);
          }, i * 80);
        }

        // æ¸…ç†å¼¹çª—
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 1500);
      },

      // åˆ›å»ºå–æ¶ˆç‚¹èµåŠ¨ç”»
      createUnlikeAnimation(message) {
        const container = document.getElementById('likeAnimationContainer');

        // åˆ›å»ºä¸­å¿ƒå¼¹çª—
        const popup = document.createElement('div');
        popup.className = 'unlike-popup';
        popup.innerHTML = `<i class="el-icon-star-off"></i> ${message}`;
        container.appendChild(popup);

        // æ¸…ç†å¼¹çª—
        setTimeout(() => {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 1500);
      },

      // è·³è½¬åˆ°è¯„ä»·é¡µé¢
      goToReviews() {
        location.href = 'reviews.html';
      },

      // è·³è½¬åˆ°è®¢å•é¡µé¢
      goToOrders() {
        location.href = 'orders.html';
      },

      // æ ¼å¼åŒ–æ•°é‡æ˜¾ç¤º
      formatCount(count) {
        if (count < 1000) {
          return count;
        } else if (count < 10000) {
          return (count / 1000).toFixed(1) + 'k';
        } else {
          return (count / 10000).toFixed(1) + 'w';
        }
      },

      // æ»šåŠ¨äº‹ä»¶å¤„ç†
      onScroll(e, type) {
        if (this.scrollThrottle) {
          clearTimeout(this.scrollThrottle);
        }

        this.scrollThrottle = setTimeout(() => {
          const container = e.target;
          const { scrollTop, clientHeight, scrollHeight } = container;
          const distanceToBottom = scrollHeight - scrollTop - clientHeight;

          if (distanceToBottom <= 100
                  && !this.isLoading(type)
                  && !this.noMoreData(type)) {
            this.loadMoreData(type);
          }
        }, 150);
      },

      // æ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½
      isLoading(type) {
        switch(type) {
          case 'blog': return this.blogLoading;
          case 'collection': return this.collectionLoading;
          case 'feed': return this.feedLoading;
          default: return false;
        }
      },

      // æ£€æŸ¥æ˜¯å¦æ— æ›´å¤šæ•°æ®
      noMoreData(type) {
        switch(type) {
          case 'blog': return this.blogNoMore;
          case 'collection': return this.collectionNoMore;
          case 'feed': return this.feedNoMore;
          default: return false;
        }
      },

      // åŠ è½½æ›´å¤šæ•°æ®æ–¹æ³•
      loadMoreData(type) {
        console.log(`æ‰§è¡ŒåŠ è½½æ›´å¤š: ${type}`);

        switch(type) {
          case 'blog':
            this.loadMoreBlogs();
            break;
          case 'collection':
            this.loadMoreCollections();
            break;
          case 'feed':
            this.loadMoreFeeds();
            break;
        }
      },

      // é‡è¯•åŠ è½½æ–¹æ³•
      retryLoadBlogs() {
        this.blogLoadError = false;
        this.loadMoreBlogs();
      },

      retryLoadFeeds() {
        this.feedLoadError = false;
        this.loadMoreFeeds();
      },

      // å¸¦åé¦ˆçš„æ ‡ç­¾åˆ‡æ¢
      switchTabWithFeedback(tabName) {
        if (this.activeName === tabName) {
          return;
        }

        // å¦‚æœæ˜¯ç²‰ä¸ã€å…³æ³¨æ ‡ç­¾ï¼Œè·³è½¬åˆ°ç‹¬ç«‹é¡µé¢
        if (tabName === 'fans') {
          location.href = 'fans.html';
          return;
        }
        if (tabName === 'follow') {
          location.href = 'follows.html';
          return;
        }

        this.activeName = tabName;
        this.currentIndex = this.tabOrder.indexOf(tabName);
        this.loadTabData(tabName);
      },

      // ç»Ÿè®¡ä¿¡æ¯ç‚¹å‡»åˆ‡æ¢
      switchTab(tabName) {
        if (tabName === 'fans') {
          location.href = 'fans.html';
          return;
        }
        if (tabName === 'follow') {
          location.href = 'follows.html';
          return;
        }
        this.switchTabWithFeedback(tabName);
      },

      // é™åˆ¶æ ‡é¢˜å­—æ•°
      truncateTitle(title, maxLength = 20) {
        if (!title) return 'æ— æ ‡é¢˜';
        if (title.length <= maxLength) return title;
        return title.substring(0, maxLength) + '...';
      },

      // åŠ è½½æ ‡ç­¾æ•°æ®
      loadTabData(tabName) {
        switch(tabName) {
          case 'note':
            if (this.blogs.length === 0) {
              this.queryBlogs();
            }
            break;
          case 'collection':
            if (this.collections.length === 0) {
              this.queryCollections();
            }
            break;
          case 'feed':
            if (this.feeds.length === 0) {
              this.queryFeeds();
            }
            break;
        }
      },

      // è·å–ç¬¬ä¸€å¼ å›¾ç‰‡
      getFirstImage(images) {
        if (!images) return '/imgs/default-blog.jpg';
        const imageArray = images.split(',');
        return fileURL+imageArray[0] || '/imgs/default-blog.jpg';
      },

      // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
      async queryUser() {
        console.log("queryUser")
        try {
          let response = await axios.get("/app/user/me")
          this.user = response.data;
          this.user.icon=fileURL+this.user.icon;
          this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ
          this.queryUserInfo();
          this.queryUserStats();
          this.queryBlogs();
          this.queryCollections(); // æ–°å¢ï¼šæŸ¥è¯¢åº—é“ºæ”¶è—
          this.queryFeeds();
        } catch (error) {
          console.error('æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
          this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
          this.$message({
            type: 'warning',
            message: 'è¯·å…ˆç™»å½•',
            duration: 1000,
            onClose: () => {
              location.href = "login.html";
            }
          });
        }
      },

      // æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…
      queryUserInfo() {
        axios.get("/app/user/info/getUserInfo/" + this.user.id)
                .then(({data}) => {
                  if (data) {
                    this.info = data;
                    sessionStorage.setItem("userInfo", JSON.stringify(data))
                    this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ
                  }
                })
                .catch(err => {
                  console.error('è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥:', err);
                  this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
                })
      },

      // æŸ¥è¯¢ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
      async queryUserStats() {
        try {
          let response = await axios.get("/app/user/stats/" + this.user.id)
          this.stats = response.data;
          this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ
        } catch (error) {
          console.error('è·å–ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
          this.stats = {
            likeCount: 0,
            fansCount: 0,
            followCount: 0
          };
          this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
        }
      },

      // æŸ¥è¯¢ç¬”è®°
      queryBlogs() {
        this.blogCurrent = 1;
        this.blogNoMore = false;
        this.blogLoadError = false;
        axios.get("/app/blog/of/me", {
          params: {
            current: this.blogCurrent,
          }
        })
                .then(({data}) => {
                  this.blogs = data || [];
                  this.blogs.forEach(blog => {
                    blog.icon = fileURL + blog.icon;
                  });
                  this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ

                  if (!data || data.length === 0) {
                    this.blogNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('è·å–ç¬”è®°å¤±è´¥:', err);
                  this.blogs = [];
                  this.blogLoadError = true;
                  this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
                })
      },

      // åŠ è½½æ›´å¤šç¬”è®°
      loadMoreBlogs() {
        if (this.blogLoading || this.blogNoMore || this.blogLoadError) return;

        this.blogLoading = true;
        this.blogLoadError = false;
        this.blogCurrent++;

        axios.get("/app/blog/of/me", {
          params: {
            current: this.blogCurrent,
            size: this.blogSize
          }
        })
                .then(({data}) => {
                  const newBlogs = data || [];
                  if (newBlogs.length > 0) {
                    this.blogs = [...this.blogs, ...newBlogs];
                  }

                  if (newBlogs.length==0) {
                    this.blogNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('åŠ è½½æ›´å¤šç¬”è®°å¤±è´¥:', err);
                  this.blogCurrent--;
                  this.blogLoadError = true;
                })
                .finally(() => {
                  this.blogLoading = false;
                });
      },

      // æŸ¥è¯¢å…³æ³¨äººç¬”è®°
      queryFeeds() {
        this.params.offset = 0;
        this.params.minTime = new Date().getTime() + 1;
        this.feedLoadError = false;
        let {minTime, offset: os} = this.params;
        axios.get("/app/blog/of/follow", {
          params: {offset: os, lastId: minTime || new Date().getTime() + 1}
        }).then(({data}) => {
          let {list, ...params} = data;
          list.forEach(item => {
            item.icon= fileURL + item.icon;
          })
          this.feeds = list || [];
          this.params = params;
          this.onDataLoaded(); // æ–°å¢ï¼šæ•°æ®åŠ è½½å®Œæˆå›è°ƒ

          if (!data || data.length === 0) {
            this.feedNoMore = true;
          }
        })
                .catch(err => {
                  console.error('è·å–åŠ¨æ€å¤±è´¥:', err);
                  this.feeds = [];
                  this.feedLoadError = true;
                  this.onDataLoaded(); // æ–°å¢ï¼šå³ä½¿å¤±è´¥ä¹Ÿå›è°ƒ
                })
      },

      // åŠ è½½æ›´å¤šå…³æ³¨äººç¬”è®°
      loadMoreFeeds() {
        if (this.feedLoading || this.feedNoMore || this.feedLoadError) return;

        this.feedLoading = true;
        this.feedLoadError = false;
        let {minTime, offset: os} = this.params;

        axios.get("/app/blog/of/follow", {
          params: {offset: os, lastId: minTime || new Date().getTime() + 1}
        })
                .then(({data}) => {
                  let {list, ...params} = data;
                  list.forEach(item => {
                    item.icon= fileURL + item.icon;
                  })
                  const newFeeds = list || [];
                  if (newFeeds.length > 0) {
                    this.feeds = [...this.feeds, ...newFeeds];
                    this.params = params;
                  }

                  if (newFeeds.length==0) {
                    this.feedNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('åŠ è½½æ›´å¤šåŠ¨æ€å¤±è´¥:', err);
                  this.feedLoadError = true;
                })
                .finally(() => {
                  this.feedLoading = false;
                });
      },

      // å…¶ä»–åŸæœ‰æ–¹æ³•
      toggleLike(blog) {
        if (blog.isLike) {
          this.unlikeBlog(blog);
        } else {
          this.likeBlog(blog);
        }
      },

      likeBlog(blog) {
        blog.isLike = true;
        this.addLike(blog)
      },

      unlikeBlog(blog) {
        blog.isLike = false;
        this.addLike(blog)
      },

      addLike(b) {
        axios.put("app/blog/like/" + b.id)
                .then(({data}) => {
                  this.queryBlogById(b);
                })
                .catch(err => {
                  this.$message.error(err)
                })
      },

      queryBlogById(b) {
        axios.get("app/blog/" + b.id)
                .then(({data}) => {
                  b.liked = data.liked;
                  b.isLike = data.isLike;
                })
                .catch(() => {
                  this.$message.error
                  b.liked++;
                })
      },

      shareBlog(blog) {
        this.$confirm('åˆ†äº«åˆ°å…¶ä»–å¹³å°?', 'åˆ†äº«', {
          confirmButtonText: 'å¤åˆ¶é“¾æ¥',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'info'
        }).then(() => {
          const url = window.location.origin + '/blog-detail.html?id=' + blog.id;
          this.copyToClipboard(url);
          this.$message.success('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(() => {
        });
      },

      copyToClipboard(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      },

      previewImage(images, index) {
        console.log('é¢„è§ˆå›¾ç‰‡:', images, 'ç±»å‹:', typeof images);
        let imageArray = [];

        if (Array.isArray(images)) {
          imageArray = images;
        } else if (typeof images === 'string' && images.trim() !== '') {
          imageArray = images.split(',').map(img => img.trim()).filter(img => img !== '');
        }

        if (!imageArray || imageArray.length === 0) {
          this.$message.warning('æ²¡æœ‰å¯é¢„è§ˆçš„å›¾ç‰‡');
          return;
        }

        console.log('å¤„ç†åçš„å›¾ç‰‡æ•°ç»„:', imageArray);

        this.previewImages = imageArray.map(img => {
          if (img.startsWith('http')) {
            return img;
          } else {
            return `http://192.168.182.20:9000${img.startsWith('/') ? '' : '/'}${img}`;
          }
        });
        this.currentPreviewIndex = index;
        this.currentPreviewImage = this.previewImages[index];
        this.showImagePreview = true;
      },
      toUserDetail(blog) {
        if (blog.userId === this.user.id) {
          // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·ï¼Œåˆ·æ–°é¡µé¢
          this.queryUser();
        } else {
          // å¦‚æœæ˜¯å…¶ä»–ç”¨æˆ·ï¼Œè·³è½¬åˆ°å¯¹æ–¹ä¸»é¡µ
          location.href = "other-info.html?id=" + blog.userId;
        }
      },

      toBlogDetail(blog) {
        location.href = "blog-detail.html?id=" + blog.id;
      },

      formatTime(time) {
        if (!time) return '';
        const date = new Date(time);
        const now = new Date();
        const diff = now - date;

        if (diff < 60000) return 'åˆšåˆš';
        if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
        if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
        if (diff < 604800000) return Math.floor(diff / 86400000) + 'å¤©å‰';

        return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
      },

      goBack() {
        history.back();
      },

      toEdit() {
        location.href = 'info-edit.html'
      },

      logout() {
        this.$confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ', 'é€€å‡ºç™»å½•', {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning',
          center: true,
          customClass: 'logout-dialog'
        }).then(() => {
          axios.post("/app/auth/appLogout")
                  .then(() => {
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
                  .catch(() => {
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
        })
      },

      changeTab(index) {
        this.activeBtn = index;
        if (index !== 4) {
          console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', index);
        }
      }
    }
  });
</script>
</body>
</html>