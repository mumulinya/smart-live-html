<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智评生活 - 个人主页</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <link rel="stylesheet" href="./css/element.css">
  <link href="./css/index.css" rel="stylesheet">
  <link href="./css/main.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background-color: #f8f9fa;
      touch-action: pan-y;
    }

    #app {
      min-height: 100vh;
      padding-bottom: 60px;
      position: relative;
      background: #f8f9fa;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 15px;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-back-btn {
      font-size: 18px;
      color: #333;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .header-back-btn:hover {
      background-color: #f5f5f5;
    }

    .header-title {
      flex: 1;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .basic {
      display: flex;
      align-items: center;
      padding: 25px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .basic-icon img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }

    .basic-icon img:hover {
      transform: scale(1.05);
    }

    .basic-info {
      flex: 1;
      margin-left: 20px;
    }

    .basic-info .name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .basic-info span {
      font-size: 14px;
      opacity: 0.9;
      display: block;
      margin-bottom: 8px;
    }

    .edit-btn {
      margin-top: 8px;
      padding: 6px 16px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 18px;
      font-size: 13px;
      display: inline-block;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.4);
      transition: all 0.3s;
      backdrop-filter: blur(5px);
    }

    .edit-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .logout-btn {
      position: absolute;
      top: 25px;
      right: 20px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: color 0.3s;
      padding: 6px 12px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
    }

    .logout-btn:hover {
      color: white;
      background: rgba(255, 255, 255, 0.2);
    }

    .stats {
      display: flex;
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }

    .stat-item {
      flex: 1;
      text-align: center;
      border-right: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.3s;
      padding: 8px 0;
      position: relative;
      overflow: hidden;
    }

    .stat-item:last-child {
      border-right: none;
    }

    .stat-item::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(64, 158, 255, 0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.6s ease;
    }

    .stat-item:active::after {
      width: 100px;
      height: 100px;
    }

    .stat-number {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
      transition: color 0.3s;
    }

    .stat-label {
      font-size: 13px;
      color: #999;
      transition: color 0.3s;
    }

    .stat-item:hover .stat-number,
    .stat-item:hover .stat-label {
      color: #409EFF;
    }

    .introduce {
      padding: 18px 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #666;
      cursor: pointer;
      transition: background-color 0.3s;
      line-height: 1.5;
      position: relative;
    }

    .introduce:hover {
      background-color: #f9f9f9;
      padding-left: 25px;
    }

    .introduce i {
      margin-left: 5px;
      color: #409EFF;
      transition: transform 0.3s;
    }

    .introduce:hover i {
      transform: translateX(3px);
    }

    .content {
      background: #f8f9fa;
      position: relative;
      overflow: hidden;
    }

    .custom-tabs-header {
      background: white;
      padding: 16px 16px 8px;
      position: relative;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .custom-tabs-nav {
      display: flex;
      justify-content: space-between;
      background: #f8f9f9;
      border-radius: 10px;
      padding: 4px;
      position: relative;
    }

    .custom-tab-item {
      flex: 1;
      text-align: center;
      padding: 14px 8px;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 2;
      margin: 0 2px;
      border: none;
      background: transparent;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      pointer-events: auto;
      /* 关键修复：防止内容过长导致变形 */
      min-width: 0;
      overflow: hidden;
    }

    .custom-tab-item::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(64, 158, 255, 0.15);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.5s ease;
      z-index: -1;
    }

    .custom-tab-item:active::before {
      width: 100%;
      height: 100%;
      border-radius: 8px;
    }

    .custom-tab-item:hover {
      color: #409EFF;
      background: rgba(64, 158, 255, 0.08);
      transform: translateY(-1px);
    }

    .custom-tab-item.active {
      color: #409EFF;
      background: white;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
      transform: translateY(0);
    }

    .custom-tab-item.active::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: #409EFF;
      border-radius: 2px;
    }

    /* 关键修复：标签文本容器 */
    .tab-text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 数量徽章样式 */
    .count-badge {
      font-size: 11px;
      background: #ff4757;
      color: white;
      border-radius: 8px;
      padding: 1px 4px;
      margin-left: 4px;
      min-width: 16px;
      text-align: center;
      line-height: 1.2;
      font-weight: 500;
    }

    .tabs-container {
      position: relative;
      height: 400px; /* 改为固定高度，确保可以滚动 */
      touch-action: pan-x;
    }

    .tabs-content {
      display: flex;
      height: 100%;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    .tab-pane {
      flex: 0 0 100%;
      height: 100%; /* 关键修复：使用父容器高度 */
      overflow-y: auto; /* 关键修复：启用滚动 */
      -webkit-overflow-scrolling: touch;
      padding-bottom: 20px;
    }

    .custom-tabs-content {
      display: block;
      height: 100%;
      margin-top: 0;
    }

    .blog-item {
      display: flex;
      padding: 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
      margin-bottom: 0;
    }

    .blog-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .blog-img {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      margin-right: 18px;
      flex-shrink: 0;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .blog-img:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .blog-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .blog-img:hover img {
      transform: scale(1.05);
    }

    .blog-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .blog-title {
      font-size: 16px;
      color: #333;
      line-height: 1.5;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition: color 0.3s;
      font-weight: 500;
      margin-bottom: 10px;
      max-width: 100%;
    }

    .blog-title:hover {
      color: #409EFF;
    }

    .blog-meta {
      display: flex;
      align-items: center;
      color: #999;
      font-size: 13px;
    }

    .blog-liked,
    .blog-comments,
    .blog-share {
      display: flex;
      align-items: center;
      margin-right: 18px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .blog-liked:hover,
    .blog-comments:hover,
    .blog-share:hover {
      background-color: #f5f5f5;
      transform: translateY(-1px);
    }

    .blog-liked.active {
      color: #ff6633;
    }

    .blog-liked.active img {
      filter: brightness(0) saturate(100%) invert(47%) sepia(90%) saturate(2000%) hue-rotate(350deg) brightness(100%) contrast(100%);
    }

    .blog-liked img,
    .blog-comments img {
      width: 16px;
      height: 16px;
      margin-right: 5px;
    }

    .user-list {
      background: white;
    }

    .user-item {
      display: flex;
      align-items: center;
      padding: 18px 20px;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
    }

    .user-item:hover {
      background-color: #f9f9f9;
      transform: translateX(5px);
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
      flex-shrink: 0;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-info {
      flex: 1;
      cursor: pointer;
    }

    .user-name {
      font-size: 16px;
      color: #333;
      margin-bottom: 5px;
      font-weight: 500;
      transition: color 0.3s;
    }

    .user-name:hover {
      color: #409EFF;
    }

    .user-desc {
      font-size: 13px;
      color: #999;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .follow-btn {
      padding: 7px 18px;
      border: 1px solid #409EFF;
      border-radius: 18px;
      color: #409EFF;
      font-size: 13px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .follow-btn:hover {
      background: #409EFF;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(64, 158, 255, 0.3);
    }

    .follow-btn.following {
      background: #f0f0f0;
      color: #999;
      border-color: #f0f0f0;
    }

    .follow-btn.following:hover {
      background: #e0e0e0;
      border-color: #e0e0e0;
      color: #777;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .review-item {
      padding: 20px;
      background: white;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s;
    }

    .review-item:hover {
      background-color: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .review-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 12px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .review-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .review-user {
      flex: 1;
    }

    .review-user-name {
      font-size: 15px;
      color: #333;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .review-rating {
      color: #ff9900;
      font-size: 13px;
    }

    .review-content {
      font-size: 14px;
      color: #333;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .review-images {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

    .review-image {
      width: 80px;
      height: 80px;
      border-radius: 6px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .review-image:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .review-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .review-footer {
      display: flex;
      align-items: center;
      color: #999;
      font-size: 13px;
    }

    .review-time {
      flex: 1;
    }

    .review-actions {
      display: flex;
      align-items: center;
    }

    .review-action {
      display: flex;
      align-items: center;
      margin-left: 15px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .review-action:hover {
      background-color: #f5f5f5;
      transform: translateY(-1px);
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #999;
      background: white;
    }

    .empty-icon {
      font-size: 60px;
      margin-bottom: 20px;
      opacity: 0.4;
    }

    .empty-text {
      font-size: 15px;
    }

    /* 加载状态指示器样式 */
    .loading-indicator {
      text-align: center;
      padding: 15px;
      color: #909399;
      font-size: 14px;
      background: white;
    }

    .loading-indicator .el-icon-loading {
      margin-right: 5px;
    }

    .no-more-data {
      text-align: center;
      padding: 15px;
      color: #C0C4CC;
      font-size: 14px;
      background: white;
    }

    .load-error {
      text-align: center;
      padding: 15px;
      color: #F56C6C;
      font-size: 14px;
      background: white;
    }

    .load-error .retry-btn {
      color: #409EFF;
      cursor: pointer;
      margin-left: 5px;
    }

    .foot-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: white;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #eee;
      z-index: 100;
    }

    .foot-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      height: 100%;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      text-decoration: none;
    }

    .foot-btn.active {
      color: #409EFF;
    }

    .foot-btn:hover {
      background-color: #f9f9f9;
    }

    .foot-icon {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .foot-text {
      font-size: 12px;
    }

    /* 退出登录提示框居中样式 */
    .el-message-box__wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .el-message-box {
      position: static !important;
      margin: 0 !important;
      top: auto !important;
      left: auto !important;
      transform: none !important;
      width: 90% !important;
      max-width: 320px !important;
    }

    .el-message-box__btns {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 15px 20px 20px;
    }

    .el-message-box__btn {
      min-width: 90px;
      padding: 8px 15px;
    }

    /* 图片预览层样式 */
    .image-preview-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .preview-container {
      background: white;
      border-radius: 8px;
      max-width: 90%;
      max-height: 90%;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-title {
      font-weight: 600;
    }

    .close-btn {
      cursor: pointer;
      font-size: 18px;
    }

    .preview-content {
      flex: 1;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-image {
      max-width: 100%;
      max-height: 400px;
      object-fit: contain;
    }

    .preview-footer {
      padding: 15px;
      border-top: 1px solid #eee;
    }

    .preview-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .nav-btn {
      background: #409EFF;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
    }

    .nav-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .preview-counter {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="header-back-btn" @click="goBack"><i class="el-icon-arrow-left"></i></div>
    <div class="header-title">个人主页</div>
  </div>

  <div class="basic">
    <div class="basic-icon">
      <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
    </div>
    <div class="basic-info">
      <div class="name">{{user.nickName || '未设置昵称'}}</div>
      <span>{{info.city || '未知城市'}}</span>
      <div class="edit-btn" @click="toEdit">
        编辑资料
      </div>
    </div>
    <div class="logout-btn" @click="logout">
      退出登录
    </div>
  </div>

  <div class="stats">
    <div class="stat-item" @click="switchTab('note')">
      <div class="stat-number">{{stats.blogCount || 0}}</div>
      <div class="stat-label">笔记</div>
    </div>
    <div class="stat-item" @click="switchTab('fans')">
      <div class="stat-number">{{stats.fansCount || 0}}</div>
      <div class="stat-label">粉丝</div>
    </div>
    <div class="stat-item" @click="switchTab('follow')">
      <div class="stat-number">{{stats.followCount || 0}}</div>
      <div class="stat-label">关注</div>
    </div>
    <div class="stat-item" @click="switchTab('review')">
      <div class="stat-number">{{stats.commentCount || 0}}</div>
      <div class="stat-label">评价</div>
    </div>
    <div class="stat-item" @click="switchTab('review')">
      <div class="stat-number">{{stats.likeCount || 0}}</div>
      <div class="stat-label">获赞</div>
    </div>
  </div>

  <div class="introduce" @click="toEdit">
    <span v-if="info.introduce">{{info.introduce}}</span>
    <span v-else>添加个人简介，让大家更好的认识你 <i class="el-icon-edit"></i></span>
  </div>

  <div class="content">
    <div class="custom-tabs-header">
      <div class="custom-tabs-nav">
        <div class="custom-tab-item"
             :class="{ active: activeName === 'note' }"
             @click="switchTabWithFeedback('note')">
          <div class="tab-text">
            笔记
            <span v-if="blogs.length > 0" class="count-badge">{{formatCount(blogs.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'review' }"
             @click="switchTabWithFeedback('review')">
          <div class="tab-text">
            评价
            <span v-if="reviews.length > 0" class="count-badge">{{formatCount(reviews.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'fans' }"
             @click="switchTabWithFeedback('fans')">
          <div class="tab-text">
            粉丝
            <span v-if="fansList.length > 0" class="count-badge">{{formatCount(fansList.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'follow' }"
             @click="switchTabWithFeedback('follow')">
          <div class="tab-text">
            关注
            <span v-if="followList.length > 0" class="count-badge">{{formatCount(followList.length)}}</span>
          </div>
        </div>
        <div class="custom-tab-item"
             :class="{ active: activeName === 'feed' }"
             @click="switchTabWithFeedback('feed')">
          <div class="tab-text">
            动态
            <span v-if="feeds.length > 0" class="count-badge">{{formatCount(feeds.length)}}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="custom-tabs-content">
      <div class="tabs-container">
        <div class="tabs-content" :style="{ transform: `translateX(-${currentIndex * 100}%)` }">

          <!-- 笔记标签页 -->
          <div class="tab-pane" @scroll="onScroll($event, 'blog')">
            <div v-if="blogs.length > 0">
              <div v-for="b in blogs" :key="b.id" class="blog-item">
                <div class="blog-img" @click="toBlogDetail(b)">
                  <img :src="getFirstImage(b.images)" alt="">
                </div>
                <div class="blog-info">
                  <div class="blog-title" @click="toBlogDetail(b)">{{ truncateTitle(b.title, 20) }}</div>
                  <div class="blog-meta">
                    <div class="blog-liked"
                         :class="{'active': b.isLike}"
                         @click.stop="toggleLike(b)">
                      <img src="/imgs/thumbup.png" alt="">
                      {{b.liked || 0}}
                    </div>
                    <div class="blog-comments" @click.stop="toBlogDetail(b)">
                      <i class="el-icon-chat-dot-round"></i>
                      {{b.comments || 0}}
                    </div>
                    <div class="blog-share" @click.stop="shareBlog(b)">
                      <i class="el-icon-share"></i>
                      分享
                    </div>
                  </div>
                </div>
              </div>

              <!-- 加载状态指示器 -->
              <div class="loading-indicator" v-if="blogLoading">
                <i class="el-icon-loading"></i> 正在加载更多笔记...
              </div>

              <div class="no-more-data" v-if="blogNoMore && !blogLoading">
                <i class="el-icon-finished"></i> 没有更多笔记了
              </div>

              <div class="load-error" v-if="blogLoadError && !blogLoading">
                <i class="el-icon-warning"></i> 加载失败
                <span class="retry-btn" @click="retryLoadBlogs">点击重试</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-document"></i></div>
              <div class="empty-text">还没有发布任何笔记</div>
            </div>
          </div>

          <!-- 评价标签页 -->
          <div class="tab-pane" @scroll="onScroll($event, 'review')">
            <div v-if="reviews.length > 0">
              <div v-for="review in reviews" :key="review.id" class="review-item">
                <div class="review-header">
                  <div class="review-avatar">
                    <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
                  </div>
                  <div class="review-user">
                    <div class="review-user-name">{{user.nickName}}</div>
                    <div class="review-rating">
                      <i class="el-icon-star-on" v-for="n in 5" :key="n"
                         :style="{color: n <= (review.rating || 5) ? '#ff9900' : '#ddd'}"></i>
                    </div>
                  </div>
                </div>
                <div class="review-content">{{review.content || '这个用户还没有写评价内容'}}</div>
                <div class="review-images" v-if="review.images">
                  <div class="review-image" v-for="(img, index) in review.images.split(',')" :key="index" @click="previewImage(img,index)">
                    <img :src="img" alt="">
                  </div>
                </div>
                <div class="review-footer">
                  <div class="review-time">{{formatTime(review.createTime)}}</div>
                  <div class="review-actions">
                    <div class="review-action">
                      <i class="el-icon-thumb"></i> {{review.liked || 0}}
                    </div>
                  </div>
                </div>
              </div>

              <!-- 加载状态指示器 -->
              <div class="loading-indicator" v-if="reviewLoading">
                <i class="el-icon-loading"></i> 正在加载更多评价...
              </div>

              <div class="no-more-data" v-if="reviewNoMore && !reviewLoading">
                <i class="el-icon-finished"></i> 没有更多评价了
              </div>

              <div class="load-error" v-if="reviewLoadError && !reviewLoading">
                <i class="el-icon-warning"></i> 加载失败
                <span class="retry-btn" @click="retryLoadReviews">点击重试</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-chat-dot-round"></i></div>
              <div class="empty-text">还没有发布任何评价</div>
            </div>
          </div>

          <!-- 粉丝标签页 -->
          <div class="tab-pane" @scroll="onScroll($event, 'fans')">
            <div class="user-list">
              <div v-if="fansList.length > 0">
                <div v-for="user in fansList" :key="user.id" class="user-item">
                  <div class="user-avatar" @click="toUserDetail(user)">
                    <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
                  </div>
                  <div class="user-info" @click="toUserDetail(user)">
                    <div class="user-name">{{user.nickName || '匿名用户'}}</div>
                    <div class="user-desc">{{user.introduce || '这个人很懒，什么都没写'}}</div>
                  </div>
                  <button class="follow-btn" :class="{'following': user.isFollow}"
                          @click.stop="toggleFollow(user)">
                    {{user.isFollow ? '已关注' : '关注'}}
                  </button>
                </div>

                <!-- 加载状态指示器 -->
                <div class="loading-indicator" v-if="fansLoading">
                  <i class="el-icon-loading"></i> 正在加载更多粉丝...
                </div>

                <div class="no-more-data" v-if="fansNoMore && !fansLoading">
                  <i class="el-icon-finished"></i> 没有更多粉丝了
                </div>

                <div class="load-error" v-if="fansLoadError && !fansLoading">
                  <i class="el-icon-warning"></i> 加载失败
                  <span class="retry-btn" @click="retryLoadFans">点击重试</span>
                </div>
              </div>
              <div v-else class="empty-state">
                <div class="empty-icon"><i class="el-icon-user"></i></div>
                <div class="empty-text">还没有粉丝</div>
              </div>
            </div>
          </div>

          <!-- 关注标签页 -->
          <div class="tab-pane" @scroll="onScroll($event, 'follow')">
            <div class="user-list">
              <div v-if="followList.length > 0">
                <div v-for="user in followList" :key="user.id" class="user-item">
                  <div class="user-avatar" @click="toUserDetail(user)">
                    <img :src="user.icon || '/imgs/icons/default-icon.png'" alt="">
                  </div>
                  <div class="user-info" @click="toUserDetail(user)">
                    <div class="user-name">{{user.nickName || '匿名用户'}}</div>
                    <div class="user-desc">{{user.introduce || '这个人很懒，什么都没写'}}</div>
                  </div>
                  <button class="follow-btn following" @click.stop="unfollow(user)">
                    已关注
                  </button>
                </div>

                <!-- 加载状态指示器 -->
                <div class="loading-indicator" v-if="followLoading">
                  <i class="el-icon-loading"></i> 正在加载更多关注...
                </div>

                <div class="no-more-data" v-if="followNoMore && !followLoading">
                  <i class="el-icon-finished"></i> 没有更多关注了
                </div>

                <div class="load-error" v-if="followLoadError && !followLoading">
                  <i class="el-icon-warning"></i> 加载失败
                  <span class="retry-btn" @click="retryLoadFollows">点击重试</span>
                </div>
              </div>
              <div v-else class="empty-state">
                <div class="empty-icon"><i class="el-icon-star-off"></i></div>
                <div class="empty-text">还没有关注任何人</div>
              </div>
            </div>
          </div>

          <!-- 动态标签页 -->
          <div class="tab-pane" @scroll="onScroll($event, 'feed')">
            <div v-if="feeds.length > 0">
              <div v-for="b in feeds" :key="b.id" class="blog-item">
                <div class="blog-img" @click="toBlogDetail(b)">
                  <img :src="getFirstImage(b.images)" alt="">
                </div>
                <div class="blog-info">
                  <div class="blog-title" @click="toBlogDetail(b)">{{ truncateTitle(b.title, 20) }}</div>
                  <div class="blog-meta">
                    <div class="blog-liked"
                         :class="{'active': b.isLike}"
                         @click.stop="toggleLike(b)">
                      <img src="/imgs/thumbup.png" alt="">
                      {{b.liked || 0}}
                    </div>
                    <div class="blog-comments" @click.stop="toBlogDetail(b)">
                      <i class="el-icon-chat-dot-round"></i>
                      {{b.comments || 0}}
                    </div>
                    <div class="blog-share" @click.stop="shareBlog(b)">
                      <i class="el-icon-share"></i>
                      分享
                    </div>
                  </div>
                </div>
              </div>

              <!-- 加载状态指示器 -->
              <div class="loading-indicator" v-if="feedLoading">
                <i class="el-icon-loading"></i> 正在加载更多动态...
              </div>

              <div class="no-more-data" v-if="feedNoMore && !feedLoading">
                <i class="el-icon-finished"></i> 没有更多动态了
              </div>

              <div class="load-error" v-if="feedLoadError && !feedLoading">
                <i class="el-icon-warning"></i> 加载失败
                <span class="retry-btn" @click="retryLoadFeeds">点击重试</span>
              </div>
            </div>
            <div v-else class="empty-state">
              <div class="empty-icon"><i class="el-icon-document"></i></div>
              <div class="empty-text">还没有关注人的动态</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <foot-bar :active-btn="4" class="foot-bar"></foot-bar>
  <!-- 图片预览层 -->
  <div class="image-preview-layer" v-if="showImagePreview" @click="closeImagePreview">
    <div class="preview-container" @click.stop>
      <div class="preview-header">
        <span class="preview-title">图片预览</span>
        <i class="el-icon-close close-btn" @click="closeImagePreview"></i>
      </div>
      <div class="preview-content">
        <img :src="currentPreviewImage" alt="预览图片" class="preview-image">
      </div>
      <div class="preview-footer">
        <div class="preview-nav">
          <button class="nav-btn" @click="prevImage" :disabled="currentPreviewIndex === 0">
            <i class="el-icon-arrow-left"></i>
          </button>
          <span class="preview-counter">{{ currentPreviewIndex + 1 }} / {{ previewImages.length }}</span>
          <button class="nav-btn" @click="nextImage" :disabled="currentPreviewIndex === previewImages.length - 1">
            <i class="el-icon-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="./js/vue.js"></script>
<script src="./js/axios.min.js"></script>
<script src="./js/element.js"></script>
<script src="./js/common.js"></script>
<script src="./js/footer.js"></script>
<script>
  new Vue({
    el: '#app',
    data() {
      return {
        user: {},
        activeName: "note",
        activeBtn: 4,
        info: {},
        blogs: [],
        reviews: [],
        fansList: [],
        followList: [],
        feeds:[],
        params: {
          minTime: 0,
          offset: 0,
        },
        stats: {
          blogCount: 0,
          fansCount: 0,
          followCount: 0,
          likeCount: 0
        },
        // 分页数据
        blogCurrent: 1,
        blogSize: 10,
        blogLoading: false,
        blogNoMore: false,
        blogLoadError: false,

        reviewCurrent: 1,
        reviewSize: 10,
        reviewLoading: false,
        reviewNoMore: false,
        reviewLoadError: false,

        fansCurrent: 1,
        fansSize: 10,
        fansLoading: false,
        fansNoMore: false,
        fansLoadError: false,

        followCurrent: 1,
        followSize: 10,
        followLoading: false,
        followNoMore: false,
        followLoadError: false,

        feedCurrent: 1,
        feedSize: 10,
        feedLoading: false,
        feedNoMore: false,
        feedLoadError: false,

        // 滑动相关数据
        currentIndex: 0,
        tabOrder: ['note', 'review', 'fans', 'follow','feed'],

        // 滚动节流
        scrollThrottle: null,

        // 图片预览相关
        showImagePreview: false,
        previewImages: [],
        currentPreviewImage: '',
        currentPreviewIndex: 0
      }
    },
    created() {
      this.queryUser();
      this.currentIndex = this.tabOrder.indexOf(this.activeName);
    },
    watch: {
      activeName(newVal) {
        this.currentIndex = this.tabOrder.indexOf(newVal);
      }
    },
    methods: {
      // 格式化数量显示
      formatCount(count) {
        if (count < 1000) {
          return count;
        } else if (count < 10000) {
          return (count / 1000).toFixed(1) + 'k';
        } else {
          return (count / 10000).toFixed(1) + 'w';
        }
      },

      // 基于首页代码的滚动事件处理
      onScroll(e, type) {
        // 节流处理，避免频繁触发
        if (this.scrollThrottle) {
          clearTimeout(this.scrollThrottle);
        }

        this.scrollThrottle = setTimeout(() => {
          const container = e.target;
          const { scrollTop, clientHeight, scrollHeight } = container;
          console.log(`${type} - ScrollTop: ${scrollTop}, ClientHeight: ${clientHeight}, ScrollHeight: ${scrollHeight}`);
          console.log(`${type} - 距离底部: ${scrollHeight - scrollTop - clientHeight}`);

          // 修复：当距离底部小于等于100px时触发（包括负数情况）
          const distanceToBottom = scrollHeight - scrollTop - clientHeight;

          // 检查状态
          console.log(`${type} - 状态: isLoading=${this.isLoading(type)}, noMoreData=${this.noMoreData(type)}`);

          if (distanceToBottom <= 100  // 距离底部小于等于100px
                  && !this.isLoading(type)
                  && !this.noMoreData(type)) {
            console.log(`✅ 触发 ${type} 加载更多，距离底部: ${distanceToBottom}`);
            this.loadMoreData(type);
          } else {
            console.log(`❌ 不触发 ${type}，原因:`, {
              distanceToBottom,
              isLoading: this.isLoading(type),
              noMoreData: this.noMoreData(type)
            });
          }
        }, 150);
      },

      // 检查是否正在加载
      isLoading(type) {
        switch(type) {
          case 'blog': return this.blogLoading;
          case 'review': return this.reviewLoading;
          case 'fans': return this.fansLoading;
          case 'follow': return this.followLoading;
          case 'feed': return this.feedLoading;
          default: return false;
        }
      },

      // 检查是否无更多数据
      noMoreData(type) {
        switch(type) {
          case 'blog': return this.blogNoMore;
          case 'review': return this.reviewNoMore;
          case 'fans': return this.fansNoMore;
          case 'follow': return this.followNoMore;
          case 'feed': return this.feedNoMore;
          default: return false;
        }
      },

      // 加载更多数据方法
      loadMoreData(type) {
        console.log(`执行加载更多: ${type}`);

        switch(type) {
          case 'blog':
            this.loadMoreBlogs();
            break;
          case 'review':
            this.loadMoreReviews();
            break;
          case 'fans':
            this.loadMoreFans();
            break;
          case 'follow':
            this.loadMoreFollows();
            break;
          case 'feed':
            this.loadMoreFeeds();
            break;
        }
      },

      // 重试加载方法
      retryLoadBlogs() {
        this.blogLoadError = false;
        this.loadMoreBlogs();
      },

      retryLoadReviews() {
        this.reviewLoadError = false;
        this.loadMoreReviews();
      },

      retryLoadFans() {
        this.fansLoadError = false;
        this.loadMoreFans();
      },

      retryLoadFollows() {
        this.followLoadError = false;
        this.loadMoreFollows();
      },

      retryLoadFeeds() {
        this.feedLoadError = false;
        this.loadMoreFeeds();
      },

      // 带反馈的标签切换
      switchTabWithFeedback(tabName) {
        if (this.activeName === tabName) {
          return;
        }

        this.activeName = tabName;
        this.currentIndex = this.tabOrder.indexOf(tabName);
        this.loadTabData(tabName);
      },

      // 统计信息点击切换
      switchTab(tabName) {
        this.switchTabWithFeedback(tabName);
      },

      // 限制标题字数
      truncateTitle(title, maxLength = 20) {
        if (!title) return '无标题';
        if (title.length <= maxLength) return title;
        return title.substring(0, maxLength) + '...';
      },

      // 加载标签数据
      loadTabData(tabName) {
        switch(tabName) {
          case 'note':
            if (this.blogs.length === 0) {
              this.queryBlogs();
            }
            break;
          case 'fans':
            if (this.fansList.length === 0) {
              this.queryFans();
            }
            break;
          case 'follow':
            if (this.followList.length === 0) {
              this.queryFollows();
            }
            break;
          case 'review':
            if (this.reviews.length === 0) {
              this.queryReviews();
            }
            break;
          case 'feed':
            if (this.feeds.length === 0) {
              this.queryFeeds();
            }
            break;
        }
      },

      // 获取第一张图片
      getFirstImage(images) {
        if (!images) return '/imgs/default-blog.jpg';
        const imageArray = images.split(',');
        return imageArray[0] || '/imgs/default-blog.jpg';
      },

      // 查询用户信息
      async queryUser() {
        console.log("queryUser")
        try {
          let response = await axios.get("/app/user/me")
          this.user = response.data;
          this.queryUserInfo();
          this.queryUserStats();
          this.queryBlogs();
        } catch (error) {
          console.error('查询用户信息失败:', error);
          this.$message({
            type: 'warning',
            message: '请先登录',
            duration: 1000,
            onClose: () => {
              location.href = "login.html";
            }
          });
        }
      },

      // 查询用户详情
      queryUserInfo() {
        axios.get("/app/user/info/getUserInfo/" + this.user.id)
                .then(({data}) => {
                  if (data) {
                    this.info = data;
                    sessionStorage.setItem("userInfo", JSON.stringify(data))
                  }
                })
                .catch(err => {
                  console.error('获取用户详情失败:', err);
                })
      },

      // 查询用户统计信息
      async queryUserStats() {
        try {
          let response = await axios.get("/app/user/stats/" + this.user.id)
          this.stats = response.data;
        } catch (error) {
          console.error('获取用户统计信息失败:', error);
          // 使用本地数据作为fallback
          this.stats = {
            blogCount: this.blogs.length,
            fansCount: this.fansList.length,
            followCount: this.followList.length,
            likeCount: this.blogs.reduce((sum, blog) => sum + (blog.liked || 0), 0)
          };
        }
      },

      // 查询笔记
      queryBlogs() {
        this.blogCurrent = 1;
        this.blogNoMore = false;
        this.blogLoadError = false;
        axios.get("/app/blog/of/me", {
          params: {
            current: this.blogCurrent,
          }
        })
                .then(({data}) => {
                  this.blogs = data || [];
                  this.queryUserStats();

                  if (!data || data.length === 0) {
                    this.blogNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('获取笔记失败:', err);
                  this.blogs = [];
                  this.blogLoadError = true;
                  this.queryUserStats();
                })
      },

      // 加载更多笔记
      loadMoreBlogs() {
        if (this.blogLoading || this.blogNoMore || this.blogLoadError) return;

        this.blogLoading = true;
        this.blogLoadError = false;
        this.blogCurrent++;

        axios.get("/app/blog/of/me", {
          params: {
            current: this.blogCurrent,
            size: this.blogSize
          }
        })
                .then(({data}) => {
                  const newBlogs = data || [];
                  if (newBlogs.length > 0) {
                    this.blogs = [...this.blogs, ...newBlogs];
                  }

                  if (newBlogs.length==0) {
                    this.blogNoMore = true;
                  }

                  this.queryUserStats();
                })
                .catch(err => {
                  console.error('加载更多笔记失败:', err);
                  this.blogCurrent--;
                  this.blogLoadError = true;
                })
                .finally(() => {
                  this.blogLoading = false;
                });
      },

      // 查询评价
      queryReviews() {
        this.reviewCurrent = 1;
        this.reviewNoMore = false;
        this.reviewLoadError = false;
        axios.get("/app/comment/of/me", {
          params: {
            current: this.reviewCurrent
          }
        })
                .then(({data}) => {
                  this.reviews = data || [];

                  // 只有当没有返回任何数据时才标记为没有更多
                  // 或者返回的数据明显少于预期（比如只有1-2条）时才标记
                  if (!data || data.length === 0) {
                    this.reviewNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('获取评价失败:', err);
                  this.reviews = [];
                  this.reviewLoadError = true;
                })
      },

      // 加载更多评价
      loadMoreReviews() {
        if (this.reviewLoading || this.reviewNoMore || this.reviewLoadError) return;

        this.reviewLoading = true;
        this.reviewLoadError = false;
        this.reviewCurrent++;

        axios.get("/app/comment/of/me", {
          params: {
            current: this.reviewCurrent
          }
        })
                .then(({data}) => {
                  const newReviews = data || [];
                  if (newReviews.length > 0) {
                    this.reviews = [...this.reviews, ...newReviews];
                  }

                  // 只有在没有返回新数据时才标记为没有更多
                  if (newReviews.length === 0) {
                    this.reviewNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('加载更多评价失败:', err);
                  this.reviewCurrent--;
                  this.reviewLoadError = true;
                })
                .finally(() => {
                  this.reviewLoading = false;
                });
      },

      // 查询粉丝列表
      queryFans() {
        this.fansCurrent = 1;
        this.fansNoMore = false;
        this.fansLoadError = false;
        axios.get("/app/user/follow/fans", {
          params: {
            current: this.fansCurrent,
          }
        })
                .then(({data}) => {
                  this.fansList = data || [];
                  this.stats.fansCount = this.fansList.length;

                  if (!data || data.length === 0) {
                    this.fansNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('获取粉丝列表失败:', err);
                  this.fansList = [];
                  this.fansLoadError = true;
                })
      },

      // 加载更多粉丝
      loadMoreFans() {
        if (this.fansLoading || this.fansNoMore || this.fansLoadError) return;

        this.fansLoading = true;
        this.fansLoadError = false;
        this.fansCurrent++;

        axios.get("/app/user/follow/fans", {
          params: {
            current: this.fansCurrent,
            size: this.fansSize
          }
        })
                .then(({data}) => {
                  const newFans = data || [];
                  if (newFans.length > 0) {
                    this.fansList = [...this.fansList, ...newFans];
                    this.stats.fansCount = this.fansList.length;
                  }

                  if (newFans.length==0) {
                    this.fansNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('加载更多粉丝失败:', err);
                  this.fansCurrent--;
                  this.fansLoadError = true;
                })
                .finally(() => {
                  this.fansLoading = false;
                });
      },

      // 查询关注列表
      queryFollows() {
        this.followCurrent = 1;
        this.followNoMore = false;
        this.followLoadError = false;
        axios.get("/app/user/follow/follows", {
          params: {
            current: this.followCurrent,
            size: this.followSize
          }
        })
                .then(({data}) => {
                  this.followList = data || [];
                  this.stats.followCount = this.followList.length;

                  if (!data || data.length === 0) {
                    this.followNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('获取关注列表失败:', err);
                  this.followList = [];
                  this.followLoadError = true;
                })
      },

      // 加载更多关注
      loadMoreFollows() {
        if (this.followLoading || this.followNoMore || this.followLoadError) return;

        this.followLoading = true;
        this.followLoadError = false;
        this.followCurrent++;

        axios.get("/app/user/follow/follows", {
          params: {
            current: this.followCurrent,
          }
        })
                .then(({data}) => {
                  const newFollows = data || [];
                  if (newFollows.length > 0) {
                    this.followList = [...this.followList, ...newFollows];
                    this.stats.followCount = this.followList.length;
                  }

                  if (newFollows.length==0) {
                    this.followNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('加载更多关注失败:', err);
                  this.followCurrent--;
                  this.followLoadError = true;
                })
                .finally(() => {
                  this.followLoading = false;
                });
      },

      // 查询关注人笔记
      queryFeeds() {
        this.params.offset = 0;
        this.params.minTime = new Date().getTime() + 1;
        this.feedLoadError = false;
        let {minTime, offset: os} = this.params;
        axios.get("/app/blog/of/follow", {
          params: {offset: os, lastId: minTime || new Date().getTime() + 1}
        }).then(({data}) => {
          let {list, ...params} = data;
          this.feeds = list || [];
          this.params = params;

          if (!data || data.length === 0) {
            this.feedNoMore = true;
          }
        })
                .catch(err => {
                  console.error('获取动态失败:', err);
                  this.feeds = [];
                  this.feedLoadError = true;
                })
      },

      // 加载更多关注人笔记
      loadMoreFeeds() {
        if (this.feedLoading || this.feedNoMore || this.feedLoadError) return;

        this.feedLoading = true;
        this.feedLoadError = false;
        let {minTime, offset: os} = this.params;

        axios.get("/app/blog/of/follow", {
          params: {offset: os, lastId: minTime || new Date().getTime() + 1}
        })
                .then(({data}) => {
                  let {list, ...params} = data;
                  const newFeeds = list || [];
                  if (newFeeds.length > 0) {
                    this.feeds = [...this.feeds, ...newFeeds];
                    this.params = params;
                  }

                  if (newFeeds.length==0) {
                    this.feedNoMore = true;
                  }
                })
                .catch(err => {
                  console.error('加载更多动态失败:', err);
                  this.feedLoadError = true;
                })
                .finally(() => {
                  this.feedLoading = false;
                });
      },

      // 点赞/取消点赞
      toggleLike(blog) {
        if (blog.isLike) {
          this.unlikeBlog(blog);
        } else {
          this.likeBlog(blog);
        }
      },

      // 点赞
      likeBlog(blog) {
        blog.isLike = true;
        this.addLike(blog)
        this.$message.success('点赞成功');
      },

      // 取消点赞
      unlikeBlog(blog) {
        blog.isLike = false;
        this.addLike(blog)
        this.$message.success('取消点赞');
      },
      addLike(b) {
        axios.put("app/blog/like/" + b.id)
                .then(({data}) => {
                  this.queryBlogById(b);
                })
                .catch(err => {
                  this.$message.error(err)
                })
      },
      queryBlogById(b) {
        axios.get("app/blog/" + b.id)
                .then(({data}) => {
                  b.liked = data.liked;
                  b.isLike = data.isLike;
                })
                .catch(() => {
                  this.$message.error
                  b.liked++;
                })
      },

      // 关注/取消关注
      toggleFollow(user) {
        axios.put("/app/user/follow/" + user.id + "/" + !user.isFollow)
                .then(() => {
                  this.$message.success(user.isFollow ? "已取消关注" : "已关注")
                  user.isFollow = !user.isFollow
                  this.queryFans();
                })
      },

      unfollow(user) {
        user.isFollow = false;
        this.$message.success('取消关注成功');
        this.stats.followCount--;
        if (this.activeName === 'follow') {
          this.followList = this.followList.filter(u => u.id !== user.id);
        }
      },

      // 分享笔记
      shareBlog(blog) {
        this.$confirm('分享到其他平台?', '分享', {
          confirmButtonText: '复制链接',
          cancelButtonText: '取消',
          type: 'info'
        }).then(() => {
          const url = window.location.origin + '/blog-detail.html?id=' + blog.id;
          this.copyToClipboard(url);
          this.$message.success('链接已复制到剪贴板');
        }).catch(() => {
          // 用户取消
        });
      },

      // 复制到剪贴板
      copyToClipboard(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      },

      // 图片预览
      previewImage(images, index) {
        console.log('预览图片:', images, '类型:', typeof images);
        let imageArray = [];

        if (Array.isArray(images)) {
          imageArray = images;
        } else if (typeof images === 'string' && images.trim() !== '') {
          imageArray = images.split(',').map(img => img.trim()).filter(img => img !== '');
        }

        if (!imageArray || imageArray.length === 0) {
          this.$message.warning('没有可预览的图片');
          return;
        }

        console.log('处理后的图片数组:', imageArray);

        this.previewImages = imageArray.map(img => {
          if (img.startsWith('http')) {
            return img;
          } else {
            return `http://192.168.182.20:9000${img.startsWith('/') ? '' : '/'}${img}`;
          }
        });
        this.currentPreviewIndex = index;
        this.currentPreviewImage = this.previewImages[index];
        this.showImagePreview = true;
      },

      // 关闭图片预览
      closeImagePreview() {
        this.showImagePreview = false;
        this.previewImages = [];
        this.currentPreviewImage = '';
        this.currentPreviewIndex = 0;
      },

      // 上一张图片
      prevImage() {
        if (this.currentPreviewIndex > 0) {
          this.currentPreviewIndex--;
          this.currentPreviewImage = this.previewImages[this.currentPreviewIndex];
        }
      },

      // 下一张图片
      nextImage() {
        if (this.currentPreviewIndex < this.previewImages.length - 1) {
          this.currentPreviewIndex++;
          this.currentPreviewImage = this.previewImages[this.currentPreviewIndex];
        }
      },

      // 跳转到用户详情
      toUserDetail(user) {
        if (user.id === this.user.id) {
          this.queryUser();
        } else {
          location.href = "other-info.html?id=" + user.id;
        }
      },

      // 跳转到笔记详情
      toBlogDetail(blog) {
        location.href = "blog-detail.html?id=" + blog.id;
      },

      // 格式化时间
      formatTime(time) {
        if (!time) return '';
        const date = new Date(time);
        const now = new Date();
        const diff = now - date;

        if (diff < 60000) return '刚刚';
        if (diff < 3600000) return Math.floor(diff / 60000) + '分钟前';
        if (diff < 86400000) return Math.floor(diff / 3600000) + '小时前';
        if (diff < 604800000) return Math.floor(diff / 86400000) + '天前';

        return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
      },

      goBack() {
        history.back();
      },

      toEdit() {
        location.href = 'info-edit.html'
      },

      logout() {
        this.$confirm('确定要退出登录吗？', '退出登录', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning',
          center: true,
          customClass: 'logout-dialog'
        }).then(() => {
          axios.post("/app/auth/appLogout")
                  .then(() => {
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
                  .catch(() => {
                    sessionStorage.removeItem("token");
                    sessionStorage.removeItem("userInfo");
                    localStorage.removeItem("userInfo");
                    location.href = "/";
                  })
        })
      },

      changeTab(index) {
        this.activeBtn = index;
        if (index !== 4) {
          console.log('切换到标签页:', index);
        }
      }
    }
  });
</script>
</body>
</html>